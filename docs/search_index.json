[["index.html", "交尾期の群れ内の凝集性に関する分析 本稿の目的", " 交尾期の群れ内の凝集性に関する分析 Tsubasa Yamaguchi 2023-06-28 本稿の目的 本稿は、個体追跡データをもとに なお、本稿の作成に使用したファイルとRのコードは筆者のGithubですべて閲覧できる。 "],["Chapter0.html", "0. パッケージの読み込み", " 0. パッケージの読み込み ## データハンドリング library(tidyverse) library(lubridate) library(readxl) library(dbplyr) ## モデリング library(lme4) library(glmmTMB) library(brms) library(rstan) library(DHARMa) library(DHARMa.helpers) library(easystats) library(ggeffects) library(ggdist) ## ネットワーク関連 library(asnipe) library(sna) library(ANTs) library(tidygraph) library(ggraph) library(igraph) ## ベイズモデルの設定 rstan_options(auto_write = TRUE) options(mc.cores = parallel::detectCores()) ## グラフや表関連 library(patchwork) library(flextable) library(ggeffects) library(DT) library(knitr) library(kableExtra) library(stargazer) library(ggsci) library(lemon) library(ggplotify) library(ggsignif) ## フォント関連 library(extrafont) require(systemfonts) require(fontregisterer) なお、本稿はRの基本操作とtidyverseパッケージによるデータハンドリングができることを前提としている。tidyverseパッケージを用いたデータ処理については、以下の書籍などを参照。 R for Data Science (Wickham &amp; Grolemund, 2016) 電子書籍, 日本語 R Graphics Coocbook 2nd Edition (Chang, 2018) 電子書籍, 日本語 RユーザのためのRstudio[実践]入門~tidyverseによるモダンな分析フローの世界 改訂2版 (松村 et al., 2021) 出版社サイト References Chang, W. (2018). R graphics cookbook: Practical recipes for visualizing data. “O’Reilly Media, Inc.” Wickham, H., &amp; Grolemund, G. (2016). R for data science: Import, tidy, transform, visualize, and model data. “O’Reilly Media, Inc.” 松村優哉., 湯谷啓明., 紀ノ定保礼., &amp; 前田和. (2021). RユーザのためのRstudio[実践]入門 tidyverseによるモダンな分析フローの世界 改訂2版. 技術評論社. "],["Chapter1.html", "1 使用する基礎データ", " 1 使用する基礎データ 以下の基礎的な情報について、データフレームを作成 daily_data18: 2018年交尾期の日ごとの追跡時間、発情メス数、群れ外オス数など。 daily_data19: 2019年交尾期の日ごとの追跡時間、発情メス数、群れ外オス数など。 daily_data20: 2020年交尾期の日ごとの追跡時間、発情メス数、群れ外オス数など。 daily_data21: 2021年交尾期の日ごとの追跡時間、発情メス数、群れ外オス数など。 daily_data19_nm: 2019年非交尾期の日ごとの追跡時間など。 daily_data21_nm: 2021年非交尾期の日ごとの追跡時間など。 daily_data22_nm: 2021年非交尾期の日ごとの追跡時間など。 female18: 2018年交尾期の全メスの確認状況と発情状況 female19: 2019年交尾期の全メスの確認状況と発情状況 female20: 2020年交尾期の全メスの確認状況と発情状況 female21: 2021年交尾期の全メスの確認状況と発情状況 male18: 2018年交尾期のオスの出欠状況 male19: 2019年交尾期のオスの出欠状況 male20: 2020年交尾期のオスの出欠状況 male21: 2021年交尾期のオスの出欠状況 個体追跡データの概要について、以下のデータフレームを作成 focal18: 2018年交尾期の個体追跡の時間と被攻撃回数 focal19: 2019年交尾期の個体追跡の時間と被攻撃回数 focal20: 2020年交尾期の個体追跡の時間と被攻撃回数 focal21: 2021年交尾期の個体追跡の時間と被攻撃回数 focal21_nm: 2021年非交尾期の個体追跡の時間 focal22_nm: 2022年非交尾期の個体追跡の時間 "],["focal_cleaning.html", "2 データクリーニング 2.1 データの読み込み 2.2 データの加工", " 2 データクリーニング 2019~2021年交尾期の個体追跡データを読み込み、データを加工する。 2.1 データの読み込み 個体追跡データを読み込む。 ## 2018交尾期 focal_raw18 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2018mating/2018mating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;, col_types = c(rep(&quot;numeric&quot;,2),rep(&quot;date&quot;,3),rep(&quot;text&quot;,1),rep(&quot;numeric&quot;,2), rep(&quot;text&quot;,2),&quot;numeric&quot;,&quot;text&quot;, rep(&quot;numeric&quot;,3),rep(&quot;text&quot;,9),rep(&quot;numeric&quot;,2),rep(&quot;text&quot;,6),rep(&quot;numeric&quot;,5),rep(&quot;text&quot;,2))) %&gt;% mutate(start_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(start_time), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(fin_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(fin_time), format = &quot;%H:%M:%S&quot;)))) ## 2019交尾期 focal_raw19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019mating/2019mating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;, col_types = c(rep(&quot;numeric&quot;,2),rep(&quot;date&quot;,3),rep(&quot;text&quot;,1),rep(&quot;numeric&quot;,2), rep(&quot;text&quot;,2),&quot;numeric&quot;,&quot;text&quot;, rep(&quot;numeric&quot;,3),rep(&quot;text&quot;,9),rep(&quot;numeric&quot;,2),rep(&quot;text&quot;,6),rep(&quot;numeric&quot;,5),rep(&quot;text&quot;,2))) %&gt;% mutate(start_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(start_time), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(fin_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(fin_time), format = &quot;%H:%M:%S&quot;)))) ## 2020交尾期 focal_raw20 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2020mating/2020mating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;, col_types = c(rep(&quot;numeric&quot;,2),rep(&quot;date&quot;,3),rep(&quot;text&quot;,1),rep(&quot;numeric&quot;,2), rep(&quot;text&quot;,2), &quot;numeric&quot;,&quot;text&quot;, rep(&quot;numeric&quot;,3),rep(&quot;text&quot;,21),rep(&quot;numeric&quot;,2),rep(&quot;text&quot;,4),rep(&quot;numeric&quot;,4),&quot;text&quot;,&quot;numeric&quot;,&quot;text&quot;)) %&gt;% mutate(start_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(start_time), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(fin_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(fin_time), format = &quot;%H:%M:%S&quot;)))) ## 2021交尾期 focal_raw21 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021mating/2021mating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;, col_types = c(rep(&quot;numeric&quot;,2),rep(&quot;date&quot;,3),rep(&quot;text&quot;,1),rep(&quot;numeric&quot;,2), rep(&quot;text&quot;,2), &quot;numeric&quot;,&quot;text&quot;, rep(&quot;numeric&quot;,3), rep(&quot;text&quot;,21),rep(&quot;numeric&quot;,2),rep(&quot;text&quot;,4),rep(&quot;numeric&quot;,4),&quot;text&quot;,&quot;numeric&quot;,&quot;text&quot;)) %&gt;% mutate(start_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(start_time), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(fin_time = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(fin_time), format = &quot;%H:%M:%S&quot;)))) ## まとめる focal_raw18 %&gt;% bind_rows(focal_raw19, focal_raw20, focal_raw21) %&gt;% mutate(study_period = ifelse(date &lt;= &quot;2018-12-10&quot;,&quot;m18&quot;, ifelse(date &gt;= &quot;2019-09-01&quot; &amp; date &lt;= &quot;2019-12-31&quot;,&quot;m19&quot;, ifelse(date &gt;= &quot;2020-09-01&quot; &amp; date &lt;= &quot;2020-12-31&quot;,&quot;m20&quot;,&quot;m21&quot;)))) %&gt;% mutate(year = year(date)) %&gt;% mutate(no_focal = str_c(study_period,&quot;_&quot;,no_focal)) %&gt;% dplyr::select(-(app_sub:no_lv2)) -&gt; focal_raw データは以下の通り。 datatable(focal_raw, options = list(scrollX = 60), filter = list(position =&quot;top&quot;)) 2.2 データの加工 2.2.1 メス情報の追加 2.2.1.1 追跡個体の発情状態と各観察日の確認メス数、最大メス数の追加 各観察日に群れで確認されたメス数(6歳以上)と、追跡個体の発情状態の列を追加する。 female_time &lt;- read_csv(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/combined_data/female_pre_all.csv&quot;) %&gt;% mutate(date = as_date(date)) female18 %&gt;% bind_rows(female19) %&gt;% bind_rows(female20) %&gt;% bind_rows(female21) -&gt; female_all female_all %&gt;% filter(age &gt;= 6) %&gt;% group_by(date) %&gt;% summarise(no_female = sum(presence)) %&gt;% ungroup() -&gt; num_female female_time %&gt;% pivot_longer(cols = Kur:Har, names_to = &quot;femaleID&quot;, values_to = &quot;presence&quot;) %&gt;% filter(is.na(presence)|(presence != &quot;DD&quot; &amp; presence != &quot;NS&quot;)) %&gt;% group_by(date) %&gt;% summarise(max_female = n()) %&gt;% ungroup() -&gt; max_female focal_raw %&gt;% left_join(num_female, by = &quot;date&quot;) %&gt;% left_join(max_female, by = &quot;date&quot;) %&gt;% left_join(female_all %&gt;% dplyr::select(date, femaleID, rank, rs2), by = c(&quot;date&quot;, &quot;subject&quot; = &quot;femaleID&quot;)) -&gt; focal_raw_b 2.2.1.2 各観察日の発情メス数のデータを追加 ## 発情メス数の追加 female_all %&gt;% group_by(date) %&gt;% summarise(no_est = sum(rs2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% right_join(focal_raw_b) -&gt; focal_raw_c 2.2.2 オスの情報の追加 2.2.2.1 群れ外オスの数 各観察日に群れで確認された群れオス以外のオスの数(no_ntm)を追加する。なお、2018年についてはデータがない。 各観察期間について以下のオスたちを群れオスとした。 2018~2019年: TY、IT、LK、KR 2020年: TY、IT、KR、KM 2021年: TY、KR、KM male19 %&gt;% bind_rows(male20) %&gt;% bind_rows(male21) %&gt;% mutate(year = year(date)) %&gt;% mutate(ntm = ifelse(year == &quot;2019&quot; &amp; maleID %in% c(&quot;TY&quot;,&quot;IT&quot;,&quot;KR&quot;,&quot;LK&quot;),0, ifelse(year == &quot;2020&quot; &amp; maleID %in% c(&quot;TY&quot;,&quot;IT&quot;,&quot;KR&quot;),0, ifelse(year == &quot;2021&quot; &amp; maleID %in% c(&quot;TY&quot;,&quot;KR&quot;,&quot;KM&quot;),0,1)))) %&gt;% replace_na(list(presence = 0))-&gt; male_all male_all %&gt;% group_by(date) %&gt;% filter(ntm == &quot;1&quot;) %&gt;% summarise(no_ntm= sum(presence)) %&gt;% ungroup() %&gt;% right_join(focal_raw_c, by = &quot;date&quot;) -&gt; focal_raw_d 2.2.2.2 TYとITの確認状況 調査期間中、第一位オスのタイヨウ(TY)と第二位オスのイツモ(IT)の群れへの出入りが頻繁に観察された。 そこで、彼らが個体追跡時にいたか否かについての列(TY、IT)を追加する。 彼らが確認できた時刻に関するデータを読み込む。 hrmales_pre19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019mating/2019mating_raw.xlsx&quot;, sheet = &quot;male_presence_long&quot;, col_types = c(&quot;date&quot;,&quot;text&quot;,&quot;numeric&quot;,&quot;date&quot;,&quot;date&quot;)) %&gt;% mutate(in_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(in_atleast), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(out_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(out_atleast), format = &quot;%H:%M:%S&quot;)))) hrmales_pre20 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2020mating/2020mating_raw.xlsx&quot;, sheet = &quot;male_presence_long&quot;, col_types = c(&quot;date&quot;,&quot;text&quot;,&quot;numeric&quot;,rep(&quot;text&quot;,2),&quot;date&quot;,&quot;date&quot;,&quot;numeric&quot;)) %&gt;% dplyr::select(-`in`,-out, -all_day) %&gt;% mutate(in_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(in_atleast), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(out_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(out_atleast), format = &quot;%H:%M:%S&quot;)))) hrmales_pre21 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021mating/2021mating_raw.xlsx&quot;, sheet = &quot;male_presence_long&quot;, col_types = c(&quot;date&quot;,&quot;text&quot;,&quot;numeric&quot;,&quot;date&quot;,&quot;date&quot;)) %&gt;% mutate(in_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(in_atleast), format = &quot;%H:%M:%S&quot;)))) %&gt;% mutate(out_atleast = as_datetime(str_c(date,&quot; &quot;, format(as.POSIXct(out_atleast), format = &quot;%H:%M:%S&quot;)))) hrmales_pre &lt;- bind_rows(hrmales_pre19, hrmales_pre20, hrmales_pre21) 個体追跡データのデータシートに列を追加する。 ## データの加工 hrmales_pre %&gt;% left_join(bind_rows(base_19b,base_20b,base_21b) %&gt;% dplyr::select(date, start, fin), by = &quot;date&quot;) %&gt;% mutate(in_atleast = ifelse(male_presence == &quot;1&quot; &amp; is.na(in_atleast), start, in_atleast)) %&gt;% mutate(out_atleast = ifelse(male_presence == &quot;1&quot; &amp; is.na(out_atleast), fin, out_atleast)) %&gt;% mutate(in_atleast = as_datetime(in_atleast), out_atleast = as_datetime(out_atleast)) %&gt;% dplyr::select(-start,-fin) -&gt; hrmales_pre_b ## TY focal_raw_d %&gt;% left_join(hrmales_pre_b %&gt;% filter(maleID == &quot;TY&quot;), by = &quot;date&quot;) %&gt;% mutate(TY = ifelse(male_presence == &quot;0&quot;,0, ifelse(male_presence == &quot;1&quot; &amp; start_time &gt;= in_atleast &amp; fin_time &lt;= out_atleast, 1, ifelse(male_presence == &quot;1&quot; &amp; fin_time &lt;= in_atleast, 0, ifelse(male_presence == &quot;1&quot; &amp; start_time &gt;= out_atleast, 0, 2))))) %&gt;% dplyr::select(-male_presence, -in_atleast, -out_atleast, -maleID)-&gt; focal_raw_e ## IT focal_raw_e %&gt;% left_join(hrmales_pre_b %&gt;% filter(maleID == &quot;IT&quot;), by = &quot;date&quot;) %&gt;% mutate(IT = ifelse(male_presence == &quot;0&quot;,0, ifelse(male_presence == &quot;1&quot; &amp; start_time &gt;= in_atleast &amp; fin_time &lt;= out_atleast, 1, ifelse(male_presence == &quot;1&quot; &amp; fin_time &lt;= in_atleast, 0, ifelse(male_presence == &quot;1&quot; &amp; start_time &gt;= out_atleast, 0, 2))))) %&gt;% dplyr::select(-male_presence, -in_atleast, -out_atleast, -maleID) -&gt; focal_raw_f ## 2018年については出入りはないので出欠状況 male_pre18 %&gt;% dplyr::select(date, TY,IT) %&gt;% rename(TY18 = TY, IT18 = IT) %&gt;% right_join(focal_raw_f, by = &quot;date&quot;) %&gt;% mutate(TY = ifelse(study_period == &quot;m18&quot;, TY18,TY)) %&gt;% mutate(IT = ifelse(study_period == &quot;m18&quot;, IT18, IT)) %&gt;% dplyr::select(-TY18, -IT18)-&gt; focal_raw_g フォーカルの途中でTYまたはITの確認状況が変わったものが５つあった。 focal_raw_g %&gt;% filter(IT == &quot;2&quot;| TY == &quot;2&quot;) %&gt;% distinct(date, no_focal, subject, TY, IT) 2.2.2.3 フォーカルを攻撃したオスのID フォーカルが攻撃を受けた際の攻撃したオスのIDを表す列を作成する。 focal_raw_g %&gt;% replace_na(list(agg_focal = 0)) %&gt;% replace_na(list(victim1 = &quot;NA&quot;, victim2 = &quot;NA&quot;, aggressor1 = &quot;NA&quot;, aggressor2 = &quot;NA&quot;)) %&gt;% mutate(if_victim1 = ifelse(agg_focal == 1 &amp; str_detect(victim1, subject),1,0), if_victim2 = ifelse(agg_focal == 1 &amp; str_detect(victim2, subject),1,0)) %&gt;% mutate(aggressor_focal = ifelse(if_victim1 == 1 &amp; if_victim2 == 1, str_c(aggressor1,&quot;,&quot;,aggressor2), ifelse(if_victim1 == 1 , aggressor1, ifelse(if_victim2 == 1, aggressor2,NA)))) %&gt;% ## aggressor2には、追跡個体が同時刻に2頭から攻撃を受けたときのみ値が入る separate(aggressor_focal, into = c(&quot;aggressor_focal1&quot;,&quot;aggressor_focal2&quot;), sep = &quot;,&quot;)-&gt; focal_raw_fin 加工したデータは以下の通り。 datatable(focal_raw_fin, options = list(scrollX = 60), filter = list(position =&quot;top&quot;)) "],["cost_of_aggression.html", "3 オスの攻撃はメスのコストになっているのか 3.1 交尾期と非交尾期の比較 3.2 交尾期内での被攻撃頻度と怪我の関連", " 3 オスの攻撃はメスのコストになっているのか 本章では、オスからの攻撃がメスの怪我の有無と関連しているかを調べることで、オスの攻撃がメスのコストになっているかを検討する。 3.1 交尾期と非交尾期の比較 3.1.1 被攻撃頻度 前提として、交尾期には非交尾期よりもオスからメスへの攻撃頻度が高いのかを検討する。ここでは、個体追跡中にメスが攻撃を受けた頻度の比較を行う。なお、交尾期のデータは対象個体が発情しているときとしていないときで分ける。 3.1.1.1 データの読み込み・加工 まず、個体追跡データから各フォーカルセッション中に攻撃を受けた回数を算出するためにデータを読み込み、加工する。 交尾期 focal_list_m &lt;- focal_raw_fin %&gt;% mutate(if_victim1 = ifelse(agg_focal == &quot;1&quot; &amp; str_detect(victim1, subject),1,0), if_victim2 = ifelse(agg_focal == &quot;1&quot; &amp; str_detect(victim2, subject),1,0)) %&gt;% group_by(no_focal, date, subject, study_period,rs2) %&gt;% summarise(duration = max(time), no_agg1 = sum(if_victim1, na.rm = TRUE), no_agg2 = sum(if_victim2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% mutate(no_agg = no_agg1 + no_agg2) %&gt;% select(-no_agg1, -no_agg2) 非交尾期 ## 2019年 focal_list19nm &lt;- focal_list19nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019nonmating/2019nonmating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;) %&gt;% group_by(no_focal, date, subject) %&gt;% summarise(duration = max(time), no_agg = sum(agg_focal)) %&gt;% ungroup() %&gt;% mutate(study_period = &quot;nm19&quot;, no_focal = str_c(study_period,&quot;_&quot;,no_focal)) ## 2021年 focal_list21nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021nonmating/2021nonmating_raw.xlsx&quot;, sheet = &quot;focal_list&quot;) %&gt;% mutate(no_focal = str_c(study_period,&quot;_&quot;,no_focal)) ## 2022年 focal_list22nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2022nonmating/2022nonmating_raw.xlsx&quot;, sheet = &quot;focal_list&quot;) %&gt;% mutate(no_focal = str_c(study_period,&quot;_&quot;,no_focal)) 全データを結合する。分析には、60分以上追跡した個体追跡セッションのみを用いる。 focal_list &lt;- bind_rows(focal_list_m,focal_list19nm, focal_list21nm, focal_list22nm) %&gt;% replace_na(list(rs2 = 0)) %&gt;% mutate(mating = ifelse(str_detect(study_period,&quot;nm&quot;),0,1)) %&gt;% mutate(cat = ifelse(rs2 == &quot;1&quot;,&quot;est&quot;, ifelse(mating == &quot;0&quot;, &quot;nm&quot;, &quot;nonest&quot;))) %&gt;% filter(duration &gt;= 60) %&gt;% mutate(logdur = log(duration/60)) データは以下の通り。 datatable(focal_list, options = list(scrollX = 20), filter = list(position =&quot;top&quot;)) 3.1.1.2 分析 3.1.1.2.1 モデリング それでは、分析を行う。モデルの概要は以下の通り。 事前分布には弱情報事前分布を用いた。 分布: 負の二項分布 リンク関数: log 応答変数: オスから攻撃された回数(no_agg) オフセット項: 各セッションの観察時間の対数(logdur) 説明変数: メスの発情状態cat(交尾期発情メスest、交尾期費発情nonest、非交尾期nm) ランダム切片: 追跡個体(subject)、調査期間(study_period) m_aggcomp &lt;- brm(no_agg ~ cat + offset(logdur) + (1|subject) + (1|study_period), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_list, file = &quot;model/m_aggcomp.rds&quot;) 3.1.1.2.1.1 モデルチェック DHARMaパッケージ及び、そのヘルパーパッケージであるDHARMa.helpersパッケージを用いてモデルチェックを行う。 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_aggcomp) ゼロ過剰の問題もなかった。 testZeroInflation(check_aggcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99946, p-value = 0.986 ## alternative hypothesis: two.sided 3.1.1.2.1.2 結果の確認 モデルの結果は以下の通り。Rhatはすべて1.01以下であり、収束の問題はないと思われる。有向サンプルサイズにも大きな問題はない。 model_parameters(m_aggcomp) 多重比較の結果は以下の通り。被攻撃頻度は交尾期発情 &gt; 交尾期非発情 &gt; 非交尾期で、いずれの差も有意。 estimate_contrasts(m_aggcomp, contrast = &quot;cat&quot;) 3.1.1.2.1.3 結果の図示 posterior_samples(m_aggcomp) %&gt;% select(1,2,3) %&gt;% rename(&quot;est&quot; = 1, &quot;nm&quot; = 2, &quot;nonest&quot; = 3) %&gt;% tidyr::expand(data.frame(cat = c(&quot;est&quot;,&quot;nonest&quot;,&quot;nm&quot;)), nesting(est, nm, nonest)) %&gt;% mutate(lambda = ifelse(cat == &quot;est&quot;, exp(est), ifelse(cat == &quot;nonest&quot;, exp(est+ nonest), ifelse(cat == &quot;nm&quot;, exp(est + nm),&quot;NA&quot;)))) %&gt;% mutate(lambda = as.numeric(lambda)) %&gt;% group_by(cat) %&gt;% summarise(Mean = mean(lambda), CI_low = quantile(lambda, 0.025), CI_high = quantile(lambda, 0.975)) -&gt; mean_aggcomp focal_list %&gt;% ungroup() %&gt;% mutate(cat = fct_relevel(cat,&quot;nm&quot;,&quot;nonest&quot;,&quot;est&quot;)) %&gt;% ggplot(aes(x = cat, y = no_agg*60/duration))+ geom_violin(scale = &quot;width&quot;, fill = &quot;grey65&quot;, color = &quot;white&quot;, bw = 0.23)+ geom_boxplot(width = 0.3, size = 0.7, outlier.alpha = 0, fill = &quot;grey42&quot;) + geom_pointrange(data = mean_aggcomp, aes(y = Mean, ymin = CI_low, ymax = CI_high), color = &quot;white&quot;, size = 0.3)+ geom_errorbar(data = mean_aggcomp, aes(y = Mean, ymin = CI_low, ymax = CI_high), width = 0.1, linewidth = 0.8, color = &quot;white&quot;)+ geom_signif(comparisons = list(c(&quot;nm&quot;,&quot;nonest&quot;)), y_position = 2.1, annotation = &quot;***&quot;) + geom_signif(comparisons = list(c(&quot;nonest&quot;,&quot;est&quot;)), y_position = 4.85, annotation = &quot;***&quot;) + geom_signif(comparisons = list(c(&quot;nm&quot;,&quot;est&quot;)), y_position = 5.3, annotation = &quot;***&quot;) + scale_y_continuous(breaks = seq(0,6,1)) + theme_bw(base_size = 15)+ labs(x = &quot;&quot;, y = &quot;被\\n攻\\n撃\\n頻\\n度\\n(回/h)&quot;) + scale_x_discrete(labels = c(&quot;非交尾期&quot;, &quot;交尾期\\n(非発情)&quot;,&quot;交尾期\\n(発情)&quot;))+ theme(axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;, size = 18)) -&gt; p_aggcomp # ggsave(&quot;figure/p_aggcomp.png&quot;, p_aggcomp, width = 120, height = 120, units = &quot;mm&quot;, dpi = 600) 結果は以下のようになる(図3.1)。 図3.1: 季節ごとの被攻撃頻度 3.1.2 怪我の頻度 それでは、実際にオスの攻撃が多い交尾期に怪我が多くなるかを調べる。先ほど同様に、交尾期のデータは対象個体が発情しているときとしていないときで分ける。 3.1.2.1 データの読み込みと加工 各メスがそれぞれの観察日に群れで最初に確認されてから、群れの観察を終了するまでの時間の長さを算出する。分析には少なくとも300分以上確認出来た個体のデータのみを用いる。2018年交尾期は確認時刻のデータがないため、それを除いた調査期間のデータを用いる。 まずは、メスが確認された時刻のデータを読み込む。 female_time &lt;- read_csv(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/combined_data/female_pre_all.csv&quot;) %&gt;% mutate(date = as_date(date)) att &lt;- read_csv(&quot;data/attributes.csv&quot;) 確認できた時間の長さを算出する。 base_18b %&gt;% bind_rows(base_19_nm, base_19b, base_20_nm, base_20b, base_21_nm, base_21b, base_22_nm) -&gt; base_all female_time %&gt;% pivot_longer(cols = Kur:Har, names_to = &quot;femaleID&quot;, values_to = &quot;presence&quot;) %&gt;% left_join(base_all %&gt;% select(date, start, fin, suspend, restart), by = &quot;date&quot;) %&gt;% ## 死亡個体と確認時間不明個体、非対称個体(6歳未満)は除く filter(presence != &quot;?&quot; &amp; presence != &quot;DD&quot; &amp; presence != &quot;NS&quot; &amp; presence != &quot;NA&quot;) %&gt;% mutate(date = as_date(date)) %&gt;% mutate(presence = str_c(date,&quot; &quot;, presence)) %&gt;% mutate(presence = as_datetime(presence)) %&gt;% mutate(suspend_time = as.numeric(restart - suspend)) %&gt;% mutate(dur = ifelse(is.na(suspend), as.numeric(fin - presence), ifelse(!is.na(suspend) &amp; presence &lt;= suspend, as.numeric(fin - presence) - suspend_time, ifelse(!is.na(suspend) &amp; presence &gt;= restart, as.numeric(fin - presence), &quot;NA&quot;)))) %&gt;% mutate(dur = as.numeric(dur)) %&gt;% mutate(season = ifelse(month(date)&gt;=9 &amp; month(date) &lt;= 12, &quot;m&quot;, &quot;nm&quot;)) %&gt;% mutate(study_period = str_c(season,str_sub(year(date),3,4))) %&gt;% dplyr::select(date, femaleID, study_period, dur) -&gt; female_dur 怪我のデータを読み込み、加工する。 ## 交尾期 injury18 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2018mating/2018mating_raw.xlsx&quot;, sheet = &quot;injury&quot;) injury19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019mating/2019mating_raw.xlsx&quot;, sheet = &quot;injury&quot;) injury20 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2020mating/2020mating_raw.xlsx&quot;,sheet = &quot;injury&quot;) injury21 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021mating/2021mating_raw.xlsx&quot;,sheet = &quot;injury&quot;) ## 非交尾期 injury19nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019nonmating/2019nonmating_raw.xlsx&quot;, sheet = &quot;injury&quot;) injury21nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021nonmating/2021nonmating_raw.xlsx&quot;,sheet = &quot;injury&quot;) injury22nm &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2022nonmating/2022nonmating_raw.xlsx&quot;,sheet = &quot;injury&quot;) ## 結合 injury &lt;- bind_rows(injury18,injury19,injury20,injury21,injury19nm,injury21nm,injury22nm) %&gt;% pivot_longer(Kur:Har, names_to = &quot;femaleID&quot;, values_to = &quot;injury&quot;) %&gt;% mutate(injury01 = ifelse(injury &gt;= 1, 1, 0)) %&gt;% mutate(injury02 = ifelse(injury &gt;= 2, 1, 0)) %&gt;% mutate(date = as_date(date)) メスが確認できた時間や発情状態のデータと結合し、観察時間が300分以上のデータのみを抽出する。 injury %&gt;% left_join(female_dur, by = c(&quot;date&quot;, &quot;femaleID&quot;)) %&gt;% filter(dur &gt;= 300) %&gt;% left_join(female_all %&gt;% dplyr::select(date, femaleID, rs2), by = c(&quot;date&quot;,&quot;femaleID&quot;)) %&gt;% replace_na(list(rs2 = 0)) %&gt;% mutate(cat = ifelse(rs2 == &quot;1&quot;,&quot;est&quot;, ifelse(str_detect(study_period, &quot;nm&quot;),&quot;nm&quot;, &quot;nonest&quot;))) -&gt; injury_fin メスの発情状態cat(交尾期発情メスest、交尾期費発情nonest、非交尾期nm)によって怪我をした日数割合を算出する。なお、分析には少なくとも5日以上その状態が観察できた場合のみを用いる。 injury_fin %&gt;% group_by(cat, femaleID, study_period) %&gt;% summarise(N = n(), no_inj = sum(injury01, na.rm = TRUE)) %&gt;% ## 5日以上観察できた状態のみ filter(N &gt;= 5) %&gt;% ungroup() -&gt; injury_long データは以下の通り。 datatable(injury_long, options = list(scrollX = 20), filter = list(position =&quot;top&quot;)) 3.1.2.2 分析 3.1.2.2.1 モデリング それでは、モデリングを行う。モデルの概要は以下の通り。 事前分布には弱情報事前分布を用いた。 分布: 二項分布 リンク関数: ロジット関数 応答変数: 怪我をした日数割合(no_inj/N) 説明変数: メスの発情状態cat(交尾期・発情est、交尾期・非発情nonest、非交尾期nm) ランダム切片: メスID(femaleID)、調査期間(study_period) m_injcomp &lt;- brm(no_inj|trials(N) ~ cat + (1|femaleID) + (1|study_period), family = binomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(3,0,4), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, data = injury_long, file = &quot;model/m_injcomp.rds&quot;) 3.1.2.2.1.1 モデルチェック DHARMaパッケージ及び、そのヘルパーパッケージであるDHARMa.helpersパッケージを用いてモデルチェックを行う。 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_injcomp) ゼロ過剰の問題もなかった。 testZeroInflation(check_injcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.1184, p-value = 0.302 ## alternative hypothesis: two.sided 3.1.2.2.1.2 結果の確認 モデルの結果は以下の通り。Rhatはすべて1.01以下であり、収束の問題はないと思われる。有向サンプルサイズにも大きな問題はない。 model_parameters(m_injcomp) 多重比較の結果は以下の通り。怪我日数割合は有意に交尾期・発情 &gt; 交尾期・非発情・非交尾期。しかし、交尾期・非発情と非交尾期の間に有意に差はなかった。これは、非交尾期にも山椒などの棘がある植物を食べた際にできた小さな怪我が結構あったため? あるいは、交尾期のデータに発情メスがいなかった日も含まれているため？ estimate_contrasts(m_injcomp, contrast = &quot;cat&quot;, ci = 0.95) 確信区間を90%にすると、非交尾期と交尾期・非発情の差の確信区間は0を含まない。 estimate_contrasts(m_injcomp, contrast = &quot;cat&quot;, ci = 0.9) 3.1.2.2.1.3 結果の図示 結果を図示する。 mean_injury &lt;- estimate_means(m_injcomp, at = &quot;cat&quot;) %&gt;% data.frame() injury_long %&gt;% mutate(cat = fct_relevel(cat,&quot;nm&quot;,&quot;nonest&quot;,&quot;est&quot;)) %&gt;% ggplot(aes(x = cat, y = no_inj/N)) + geom_violin(scale = &quot;width&quot;, fill = &quot;grey65&quot;, color = &quot;white&quot;, bw = 0.043)+ geom_boxplot(width = 0.4, size = 0.7, outlier.alpha = 0, fill = &quot;grey42&quot;) + geom_signif(comparisons = list(c(&quot;nm&quot;,&quot;nonest&quot;)), y_position = 0.2, annotation = &quot;†&quot;) + geom_signif(comparisons = list(c(&quot;nonest&quot;,&quot;est&quot;)), y_position = 0.58, annotation = &quot;***&quot;) + geom_signif(comparisons = list(c(&quot;nm&quot;,&quot;est&quot;)), y_position = 0.63, annotation = &quot;***&quot;) + geom_pointrange(data = mean_injury, aes(y = Probability, ymin = CI_low, ymax = CI_high), color = &quot;white&quot;, size = 0.3)+ geom_errorbar(data = mean_injury, aes(y = Probability, ymin = CI_low, ymax = CI_high), width = 0.1, linewidth = 0.8, color = &quot;white&quot;)+ scale_y_continuous(breaks = seq(0,0.6,0.1)) + theme_bw(base_size = 15)+ labs(x = &quot;&quot;, y = &quot;怪\\n我\\n日\\n数\\n割\\n合\\n(回/日)&quot;) + scale_x_discrete(labels = c(&quot;非交尾期&quot;, &quot;交尾期\\n(非発情)&quot;,&quot;交尾期\\n(発情)&quot;))+ theme(axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;, size = 18)) -&gt; p_injcomp # ggsave(&quot;figure/p_injcomp.png&quot;, p_injcomp, width = 140, height = 120, units = &quot;mm&quot;, dpi = 600) 結果は以下のようになる(図3.2)。 図3.2: 季節ごとの被攻撃頻度 3.2 交尾期内での被攻撃頻度と怪我の関連 交尾期に着目し、メスの被攻撃頻度と怪我の有無の関連を調べる。 3.2.1 データの読み込み・加工 各観察日に確認された各メスへのオスの攻撃頻度(全生起サンプリング)を計算する。群れオスと群れ外オスを分けて算出する。 まず、攻撃のrawデータを読み込む。 agg18 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2018mating/2018mating_raw.xlsx&quot;, sheet = &quot;agg_MF&quot;) agg19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019mating/2019mating_raw.xlsx&quot;, sheet = &quot;agg_MF&quot;) agg20 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2020mating/2020mating_raw.xlsx&quot;, sheet = &quot;agg_MF&quot;) agg21 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021mating/2021mating_raw.xlsx&quot;, sheet = &quot;agg_MF&quot;) ## 結合 bind_rows(agg18, agg19, agg20, agg21) %&gt;% dplyr::select(date, type, type_no, aggressor, victim:victim3) %&gt;% mutate(date = as_date(date)) %&gt;% pivot_longer(cols = victim:victim3, names_to = &quot;victim&quot;, values_to = &quot;femaleID&quot;) %&gt;% drop_na(femaleID) %&gt;% dplyr::select(-victim) %&gt;% mutate(aggressor = str_replace(aggressor,&quot;\\\\?&quot;,&quot;&quot;)) %&gt;% mutate(study_period = str_c(&quot;m&quot;,str_sub(year(date),3,4)))-&gt; aggression_all データは以下の通り。 datatable(aggression_all, filter = list(position =&quot;top&quot;)) 各メスごとに被攻撃頻度を算出する。各調査期間に6歳以上だったメスを対象とする。 各年のオスの情報についてデータフレームを作成する。 ## 対象のオス bind_rows(data.frame(study_period = &quot;m18&quot;, maleID = c(&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;EG&quot;), ntm = c(0,0,0,0,1)), data.frame(study_period = &quot;m19&quot;, maleID = c(&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;TM&quot;,&quot;KM&quot;,&quot;TG&quot;,&quot;EG&quot;,&quot;SH&quot;,&quot;JN&quot;,&quot;RU&quot;,&quot;KY&quot;,&quot;RY&quot;), ntm = c(0,0,0,0,0,1,1,1,1,1,1,1,1)), data.frame(study_period = &quot;m20&quot;, maleID = c(&quot;TY&quot;,&quot;IT&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;TG&quot;,&quot;EG&quot;,&quot;SH&quot;,&quot;RU&quot;,&quot;RY&quot;,&quot;HG&quot;,&quot;FU&quot;,&quot;KY&quot;), ntm = c(0,0,0,1,1,1,1,1,1,1,1,1)), data.frame(study_period = &quot;m21&quot;, maleID = c(&quot;TY&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;TG&quot;,&quot;EG&quot;,&quot;SH&quot;,&quot;JN&quot;,&quot;RU&quot;,&quot;KY&quot;,&quot;HT&quot;,&quot;RY&quot;), ntm = c(0,0,0,1,1,1,1,1,1,1,1))) -&gt; males 攻撃データに攻撃したオスと攻撃されたメスの情報を追加する。 aggression_all %&gt;% left_join(att, by = c(&quot;femaleID&quot;,&quot;study_period&quot;)) %&gt;% left_join(males, by = c(&quot;aggressor&quot; = &quot;maleID&quot;,&quot;study_period&quot;)) %&gt;% filter(age &gt;= 6) -&gt; aggression_all_b データを基に、それぞれのメスが各観察日に群れオス・群れ外オスそれぞれから攻撃された頻度を求める。 aggression_all_b %&gt;% filter(!is.na(ntm)) %&gt;% filter(type_no &gt;= 1) %&gt;% group_by(date, femaleID, ntm) %&gt;% summarise(no_agg = n()) %&gt;% ungroup() %&gt;% pivot_wider(names_from = ntm, values_from = no_agg) %&gt;% rename(agg_tm = `0`, agg_ntm = `1`) -&gt; agg_female_ntm 分析には少なくとも300分以上確認出来た個体のデータのみを用いる。攻撃データをメスの怪我の状況や確認時間長などが載っているデータフレーム(injury_fin)に結合する。 injury_fin %&gt;% left_join(agg_female_ntm, by = c(&quot;date&quot;,&quot;femaleID&quot;)) %&gt;% ## 交尾期データのみ filter(!str_detect(study_period,&quot;nm&quot;)) %&gt;% filter(dur &gt;= 300) %&gt;% ## 各観察日の群れ追跡時間を結合 left_join(base_all %&gt;% dplyr::select(date, duration)) %&gt;% ## NAになっているところを0で埋める replace_na(list(agg_tm = 0, agg_ntm = 0)) %&gt;% ## 被攻撃頻度を算出 mutate(rate_agg_tm = agg_tm*60/duration, rate_agg_ntm = agg_ntm*60/duration, rate_agg_tm2 = agg_tm*60/dur, rate_agg_ntm2 = agg_ntm*60/dur) -&gt; agg_injury_ntm 3.2.2 分析1 (群れオス・群れ外オスを区別) 3.2.2.1 モデリング それでは、モデリングを行う。モデルの詳細は以下のとおりである。 事前分布には弱情報事前分布を用いた。 分布: ベルヌーイ分布 リンク関数: ロジット関数 応答変数: 怪我が確認されたか否か(injury01) 説明変数: 群れオスからの攻撃頻度(rate_agg_tm)、群れ外オスからの攻撃頻度(rate_agg_ntm`)、メスの発情の有無(rs2)、調査期間(study_period`) ランダム切片: メスID(femaleID) ## 被攻撃頻度を群れ追跡時間から算出 m_agginj &lt;- brm(injury01 ~ rate_agg_tm + rate_agg_ntm + rs2 + study_period + (1|femaleID), family = bernoulli, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_injury_ntm, file = &quot;model/m_agginj.rds&quot;) ## 被攻撃頻度を各個体を確認した時刻から群れ追跡終了時刻までの時間で算出 m_agginj2 &lt;- brm(injury01 ~ rate_agg_tm2 + rate_agg_ntm2 + rs2 + study_period + (1|femaleID), family = bernoulli, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_injury_ntm, file = &quot;model/m_agginj2.rds&quot;) 3.2.2.1.0.1 モデルチェック DHARMaパッケージ及び、そのヘルパーパッケージであるDHARMa.helpersパッケージを用いてモデルチェックを行う。 いずれのモデルも、分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_agginj) plotQQunif(check_agginj2) 3.2.2.1.0.2 結果の確認 モデルの結果は以下の通り。Rhatはすべて1.01以下であり、収束の問題はないと思われる。有向サンプルサイズにも大きな問題はない。 いずれのモデルでも、群れオス・群れ外オスの攻撃いずれもが怪我と有意に関連。 model_parameters(m_agginj) model_parameters(m_agginj2) 3.2.2.1.1 結果の作図 群れオス nd_agginj_tm &lt;- tidyr::crossing(rate_agg_tm = seq(0,2,length.out =100), rate_agg_ntm = mean(agg_injury_ntm$rate_agg_ntm), study_period = c(&quot;m18&quot;,&quot;m19&quot;,&quot;m20&quot;,&quot;m21&quot;), rs2 = c(0,1)) fit_agginj_tm &lt;- fitted(m_agginj, newdata = nd_agginj_tm, re_formula = NA) %&gt;% bind_cols(nd_agginj_tm) agg_injury_ntm %&gt;% ggplot(aes(x = rate_agg_tm, y = injury01, color = study_period))+ geom_point(shape = &quot;|&quot;, size = 3)+ geom_line(data = fit_agginj_tm, aes(y = Estimate, linetype = as.factor(rs2)), size = 0.7)+ theme_bw(base_size = 14)+ scale_y_continuous(breaks = seq(0,1,by = 0.2)) + labs(x = &quot;群れオスからの攻撃頻度&quot;, y = &quot;怪\\n我\\n日\\n数\\n割\\n合\\n(回/日)&quot;, color = &quot;調査期間&quot;, linetype = &quot;発情の有無&quot;) + scale_color_nejm()+ theme(axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.title.x = element_text(family = &quot;Yu Mincho&quot;), axis.text = element_text(family = &quot;Times New Roman&quot;, size = 13), legend.position = &quot;none&quot;, legend.title = element_text(family = &quot;Yu Mincho&quot;), aspect.ratio = 1) -&gt; p_agginj_tm 群れ外オス nd_agginj_ntm &lt;- tidyr::crossing(rate_agg_ntm = seq(0,1,length.out =100), rate_agg_tm = mean(agg_injury_ntm$rate_agg_tm), study_period = c(&quot;m18&quot;,&quot;m19&quot;,&quot;m20&quot;,&quot;m21&quot;), rs2 = c(0,1)) fit_agginj_ntm &lt;- fitted(m_agginj, newdata = nd_agginj_ntm, re_formula = NA) %&gt;% bind_cols(nd_agginj_ntm) agg_injury_ntm %&gt;% ggplot(aes(x = rate_agg_ntm, y = injury01, color = study_period))+ geom_point(shape = &quot;|&quot;, size = 3)+ geom_line(data = fit_agginj_ntm, aes(y = Estimate, linetype = as.factor(rs2)), size = 0.7)+ theme_bw(base_size = 14)+ scale_y_continuous(breaks = seq(0,1,by = 0.2)) + labs(x = &quot;群れ外オスからの攻撃頻度&quot;, y = &quot;怪\\n我\\n日\\n数\\n割\\n合\\n(回/日)&quot;, color = &quot;調査期間&quot;, linetype = &quot;発情の有無&quot;) + scale_color_nejm()+ coord_cartesian(xlim = c(0,1.02))+ scale_x_continuous(breaks = seq(0,1,by=0.2))+ theme(axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.title.x = element_text(family = &quot;Yu Mincho&quot;), axis.text = element_text(family = &quot;Times New Roman&quot;, size = 13), legend.title = element_text(family = &quot;Yu Mincho&quot;), aspect.ratio = 1) -&gt; p_agginj_ntm p_agginj &lt;- p_agginj_tm + p_agginj_ntm # ggsave(&quot;figure/p_agginj.png&quot;, p_agginj, width = 230, height = 120, units = &quot;mm&quot;, dpi = 600) 結果は以下のようになる(図3.3)。 図3.3: 被攻撃頻度と怪我の関連 3.2.3 分析2 (群れオス・群れ外オスを区別しない) 3.2.3.1 データの加工 オスの属性を問わず、それぞれのメスが各観察日にオスから攻撃された頻度を求め、怪我のデータと結合する。 aggression_all_b %&gt;% filter(type_no &gt;= 1) %&gt;% group_by(date, femaleID) %&gt;% summarise(no_agg = n()) %&gt;% ungroup() -&gt; agg_female_all 分析には少なくとも300分以上確認出来た個体のデータのみを用いる。攻撃データをメスの怪我の状況や確認時間長などが載っているデータフレーム(injury_fin)に結合する。 injury_fin %&gt;% left_join(agg_female_all, by = c(&quot;date&quot;,&quot;femaleID&quot;)) %&gt;% ## 交尾期データのみ filter(!str_detect(study_period,&quot;nm&quot;)) %&gt;% filter(dur &gt;= 300) %&gt;% ## 各観察日の群れ追跡時間を結合 left_join(base_all %&gt;% dplyr::select(date, duration)) %&gt;% ## NAになっているところを0で埋める replace_na(list(no_agg = 0)) %&gt;% ## 被攻撃頻度を算出 mutate(rate_agg = no_agg*60/duration, rate_agg2 = no_agg*60/dur) -&gt; agg_injury_all 3.2.3.2 モデリング それでは、モデリングを行う。モデルの詳細は以下のとおりである。 事前分布には弱情報事前分布を用いた。 分布: ベルヌーイ分布 リンク関数: ロジット関数 応答変数: 怪我が確認されたか否か(injury01) 説明変数: オスからの攻撃頻度(rate_agg``)、メスの発情の有無(rs2)、攻撃頻度と発情の有無の交互作用、調査期間(study_period`) ランダム切片: メスID(femaleID) ## 被攻撃頻度を群れ追跡時間から算出 m_agginj_all &lt;- brm(injury01 ~ rate_agg + rs2 + rate_agg:rs2 + study_period + (1|femaleID), family = bernoulli, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_injury_all, file = &quot;model/m_agginj_all.rds&quot;) ## 被攻撃頻度を各個体を確認した時刻から群れ追跡終了時刻までの時間で算出 m_agginj_all2 &lt;- brm(injury01 ~ rate_agg2 + rs2 + rate_agg2:rs2 + study_period + (1|femaleID), family = bernoulli, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_injury_all, file = &quot;model/m_agginj_all2.rds&quot;) 3.2.3.2.0.1 モデルチェック DHARMaパッケージ及び、そのヘルパーパッケージであるDHARMa.helpersパッケージを用いてモデルチェックを行う。 いずれのモデルも、分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_agginj_all) plotQQunif(check_agginj_all2) 3.2.3.2.0.2 結果の確認 1つ目のモデル モデルの結果は以下の通り。Rhatはすべて1.01以下であり、収束の問題はないと思われる。有向サンプルサイズにも大きな問題はない。 model_parameters(m_agginj_all) 交互作用項を含む結果を確認する。発情メス、非発情メスのいずれについても「オスからの攻撃が多い日ほど有意に怪我をする確率が高くなっていた。 estimate_slopes(m_agginj_all, trend = &quot;rate_agg&quot;, at = &quot;rs2 = c(0,1)&quot;) 2つ目のモデル こちらも結果は変わらず。 model_parameters(m_agginj_all2) estimate_slopes(m_agginj_all2, trend = &quot;rate_agg2&quot;, at = &quot;rs2 = c(0,1)&quot;) 3.2.3.2.1 結果の作図 nd_agginj_all &lt;- tidyr::crossing(rate_agg = seq(0,2,length.out =100), study_period = c(&quot;m18&quot;,&quot;m19&quot;,&quot;m20&quot;,&quot;m21&quot;), rs2 = c(0,1)) fit_agginj_all &lt;- fitted(m_agginj_all, newdata = nd_agginj_all, re_formula = NA) %&gt;% bind_cols(nd_agginj_all) agg_injury_all %&gt;% ggplot(aes(x = rate_agg, y = injury01, color = study_period))+ geom_point(shape = &quot;|&quot;, size = 3)+ geom_line(data = fit_agginj_all, aes(y = Estimate, linetype = as.factor(rs2)), linewidth = 0.7)+ theme_bw(base_size = 14)+ scale_y_continuous(breaks = seq(0,1,by = 0.2)) + labs(x = &quot;オスからの攻撃頻度&quot;, y = &quot;怪\\n我\\n日\\n数\\n割\\n合\\n(回/日)&quot;, color = &quot;調査期間&quot;, linetype = &quot;発情の有無&quot;) + scale_color_nejm()+ theme(axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.title.x = element_text(family = &quot;Yu Mincho&quot;), axis.text = element_text(family = &quot;Times New Roman&quot;, size = 13), legend.title = element_text(family = &quot;Yu Mincho&quot;), aspect.ratio = 1) -&gt; p_agginj_all # ggsave(&quot;figure/p_agginj_all.png&quot;, p_agginj_all, width = 240, height = 120, units = &quot;mm&quot;, dpi = 600) 結果は以下のようになる(図3.4)。 図3.4: 被攻撃頻度と怪我の関連 "],["factor_of_aggression.html", "4 メスの被攻撃頻度はどのようなときに多くなるか 4.1 個体追跡データによる分析 4.2 全生起サンプリングを用いた分析", " 4 メスの被攻撃頻度はどのようなときに多くなるか 以下では、メスがオスから攻撃される頻度がどのような要因によって変化するのかを検討する。 4.1 個体追跡データによる分析 4.1.1 データの加工 個体追跡の生データを加工する。メスの被攻撃頻度に関連する要因としては、以下のものを考える。2018年は群れ外オス数が確認できていないため、ここでは除外する。また、60分以上追跡できた個体追跡セッションのみを用いる。 追跡個体の発情の有無 観察日の群れ外オス数 観察日の発情メス数 観察時のTYの有無、ITの有無(2019~2020年のみ) 群れオス・群れ外オスを区別せず focal_raw_fin %&gt;% group_by(no_focal, subject, rs2, TY, IT) %&gt;% summarise(no_agg1 = sum(if_victim1, na.rm = TRUE), no_agg2 = sum(if_victim2, na.rm = TRUE), dur = max(time), no_ntm = mean(no_ntm, na.rm = TRUE), no_est = mean(no_est, na.rm = TRUE), study_period = unique(study_period)) %&gt;% ungroup() %&gt;% mutate(no_agg = no_agg1 + no_agg2) %&gt;% select(-no_agg1, -no_agg2) %&gt;% mutate(logdur = log(dur/60)) %&gt;% replace_na(list(IT = 0)) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm, na.rm = TRUE), cen_est = no_est - mean(no_est, na.rm = TRUE), std_ntm = standardize(no_ntm), std_est = standardize(no_est)) -&gt; focal_sum 群れオス・群れ外オスを区別 focal_raw_fin %&gt;% left_join(males, by = c(&quot;study_period&quot;, &quot;aggressor_focal1&quot; = &quot;maleID&quot;)) %&gt;% rename(ntm1 = ntm) %&gt;% mutate(ntm1 = ifelse(is.na(aggressor_focal1),NA, ifelse(is.na(ntm1) &amp; !is.na(aggressor_focal1),1,ntm1))) %&gt;% left_join(males, by = c(&quot;study_period&quot;, &quot;aggressor_focal2&quot; = &quot;maleID&quot;)) %&gt;% rename(ntm2 = ntm) %&gt;% mutate(ntm2 = ifelse(is.na(aggressor_focal2),NA, ifelse(is.na(ntm2) &amp; !is.na(aggressor_focal2),1,ntm2))) -&gt; focal_raw_fin_b focal_raw_fin_b %&gt;% filter(agg_focal == &quot;1&quot;) %&gt;% group_by(no_focal, subject, ntm1) %&gt;% summarise(no_agg = sum(agg_focal, na.rm = TRUE)) %&gt;% ungroup() %&gt;% pivot_wider(names_from = ntm1, values_from = no_agg) %&gt;% rename(agg_tm1 = `0`, agg_ntm1 = `1`) %&gt;% replace_na(list(agg_tm1 = 0, agg_ntm1 = 0))-&gt; focal_list_ntm1 focal_raw_fin_b %&gt;% filter(agg_focal == &quot;1&quot; &amp; !is.na(aggressor_focal2)) %&gt;% group_by(no_focal, subject, ntm2) %&gt;% summarise(no_agg = sum(agg_focal, na.rm = TRUE)) %&gt;% ungroup() %&gt;% pivot_wider(names_from = ntm2, values_from = no_agg) %&gt;% rename(agg_tm2 = `0`, agg_ntm2 = `1`) %&gt;% replace_na(list(agg_tm2 = 0, agg_ntm2 = 0)) -&gt; focal_list_ntm2 left_join(focal_list_ntm1, focal_list_ntm2) %&gt;% replace_na(list(agg_tm2 = 0, agg_ntm2 = 0)) %&gt;% mutate(agg_tm = agg_tm1 + agg_tm2, agg_ntm = agg_ntm1 + agg_ntm2) %&gt;% select(-(agg_tm1:agg_ntm2)) %&gt;% right_join(focal_sum) %&gt;% replace_na(list(agg_tm = 0, agg_ntm = 0)) -&gt; focal_sum_ntm まとめたものは以下の通り。 datatable(focal_sum, options = list(scrollX = 10), filter = list(position =&quot;top&quot;)) 4.1.2 データの確認 4.1.2.1 調査年ごとの被攻撃頻度 調査期間ごとに、発情メス・非発情メスが群れオス・群れ外オスから攻撃された頻度を図示する。 focal_sum_ntm %&gt;% filter(dur &gt;= 60) %&gt;% pivot_longer(agg_tm:agg_ntm, names_to = &quot;type&quot;, values_to= &quot;agg&quot;) %&gt;% ggplot(aes(x = study_period, y = agg*60/dur))+ geom_violin(aes(fill = type), bw = 0.25, color = &quot;black&quot;, scale = &quot;width&quot;)+ geom_boxplot(aes(color = type), fill = &quot;grey85&quot;, outlier.alpha = 0, width = 0.2, size = 0.2, position = position_dodge(0.9))+ stat_summary(aes(fill = type), fun = &quot;mean&quot;, position = position_dodge(0.9), shape = 18, size = 0.5)+ labs(x = &quot;&quot;, y = &quot;被\\n攻\\n撃\\n頻\\n度\\n(回/h)&quot;, fill = &quot;&quot;, color = &quot;&quot;)+ facet_rep_wrap(~rs2, repeat.tick.labels = TRUE, ncol = 2, labeller = as_labeller(c(&quot;0&quot; = &quot;非発情メス&quot;,&quot;1&quot; = &quot;発情メス&quot;)))+ theme_bw(base_size = 15)+ scale_fill_manual(values = c(&quot;grey54&quot;,&quot;white&quot;), labels = c(&quot;群れ外オス&quot;,&quot;群れオス&quot;))+ scale_color_manual(values = c(&quot;grey10&quot;,&quot;grey10&quot;), labels = c(&quot;群れ外オス&quot;,&quot;群れオス&quot;))+ scale_x_discrete(labels = c(&quot;2018年&quot;,&quot;2019年&quot;,&quot;2020年&quot;,&quot;2021年&quot;))+ theme(aspect.ratio = 0.7, strip.background = element_blank(), strip.text = element_text(family = &quot;Yu Mincho&quot;, hjust = 0), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.title.y = element_text(family = &quot;Yu Mincho&quot;, angle = 0, vjust = 0.5), legend.text = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;)) -&gt; p_focalagg_studyperiod # ggsave(&quot;figure/p_focalagg_studyperiod.png&quot;, p_focalagg_studyperiod, width = 270, height = 110, units = &quot;mm&quot;, dpi = 600) 以下の通り。 図4.1: 調査期間ごとの被攻撃頻度 4.1.2.2 オスごとの攻撃頻度 4.1.2.2.1 データの加工 focal_raw_fin_b %&gt;% mutate(aggressor1 = ifelse(ntm1 == &quot;1&quot;, &quot;NT&quot;, aggressor_focal1)) %&gt;% mutate(aggressor2 = ifelse(ntm2 == &quot;1&quot;, &quot;NT&quot;, aggressor_focal2)) -&gt; focal_raw_maleID focal_raw_maleID %&gt;% filter(agg_focal == &quot;1&quot;) %&gt;% group_by(no_focal, subject, aggressor1) %&gt;% summarise(agg_ID = n()) %&gt;% ungroup() %&gt;% rename(aggressor = aggressor1) -&gt; focal_agg_ID1 focal_raw_maleID %&gt;% filter(agg_focal == &quot;1&quot;) %&gt;% group_by(no_focal, subject, aggressor2) %&gt;% summarise(agg_ID = n()) %&gt;% ungroup() %&gt;% drop_na(aggressor2) %&gt;% rename(aggressor = aggressor2) -&gt; focal_agg_ID2 focal_agg_ID1 %&gt;% bind_rows(focal_agg_ID2) %&gt;% group_by(no_focal, aggressor) %&gt;% summarise(agg = sum(agg_ID)) %&gt;% ungroup() -&gt; focal_agg_ID focal_agg_ID %&gt;% right_join(focal_sum_ntm) %&gt;% drop_na(aggressor) %&gt;% replace_na(list(agg = 0)) %&gt;% select(no_focal, aggressor) %&gt;% complete(no_focal, aggressor) %&gt;% left_join(focal_agg_ID) %&gt;% replace_na(list(agg = 0)) %&gt;% right_join(focal_sum_ntm) %&gt;% mutate(inc = ifelse(study_period %in% c(&quot;m18&quot;,&quot;m19&quot;,&quot;m20&quot;) &amp; aggressor == &quot;KM&quot;| study_period == &quot;m21&quot; &amp; aggressor == &quot;IT&quot;| study_period %in% c(&quot;m20&quot;,&quot;m21&quot;) &amp; aggressor == &quot;LK&quot;,0,1)) %&gt;% filter(inc == &quot;1&quot;) %&gt;% mutate(inc2 = ifelse(TY == &quot;0&quot; &amp; aggressor == &quot;TY&quot;|IT == &quot;0&quot; &amp; aggressor == &quot;IT&quot;, 0,1)) %&gt;% filter(inc2 == &quot;1&quot;)-&gt; focal_sum_ID 4.1.2.2.2 図示 N &lt;- focal_sum_ID %&gt;% mutate(rs2 = as.factor(rs2)) %&gt;% mutate(rate_agg = agg*60/dur) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% mutate(aggressor = fct_relevel(aggressor,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;NT&quot;)) %&gt;% filter(dur &gt;= 60) %&gt;% group_by(study_period, aggressor, rs2) %&gt;% summarise(N = n(), y = max(rate_agg + 0.3)) %&gt;% ungroup() focal_sum_ID %&gt;% mutate(rs2 = as.factor(rs2)) %&gt;% filter(dur &gt;= 60) %&gt;% mutate(rate_agg = agg*60/dur) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% mutate(aggressor = fct_relevel(aggressor,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;NT&quot;)) %&gt;% ggplot(aes(x = aggressor, y = rate_agg))+ geom_violin(aes(fill = rs2), bw = 0.25, color = &quot;black&quot;, scale = &quot;width&quot;)+ geom_boxplot(aes(color = rs2), fill = &quot;grey85&quot;, outlier.alpha = 0, width = 0.25, position = position_dodge(0.9), size = 0.2)+ stat_summary(aes(fill = rs2), fun = &quot;mean&quot;, position = position_dodge(0.9), shape = 18, size = 0.35)+ geom_text(data = N, aes(y = y, color = rs2, label = N), stat = &quot;identity&quot;, position = position_dodge(0.9), family = &quot;Times New Roman&quot;, size = 3) + labs(x = &quot;&quot;, y = &quot;被\\n攻\\n撃\\n頻\\n度\\n(回/h)&quot;, fill = &quot;&quot;, color = &quot;&quot;)+ facet_rep_wrap(~study_period, repeat.tick.labels = TRUE, ncol = 2) + theme_bw(base_size = 15)+ scale_fill_manual(values = c(&quot;grey54&quot;,&quot;white&quot;), labels = c(&quot;非発情メス&quot;,&quot;発情メス&quot;))+ scale_color_manual(values = c(&quot;grey10&quot;,&quot;grey10&quot;), labels = c(&quot;非発情メス&quot;,&quot;発情メス&quot;))+ theme(aspect.ratio = 0.5, strip.background = element_blank(), strip.text = element_text(family = &quot;Yu Mincho&quot;, hjust = 0), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.title.y = element_text(family = &quot;Yu Mincho&quot;, angle = 0, vjust = 0.5), legend.text = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;)) -&gt; p_focalagg_maleID # ggsave(&quot;figure/p_focalagg_maleID.png&quot;, p_focalagg_maleID, width = 270, height = 130, units = &quot;mm&quot;, dpi = 600) 以下の通り。 図4.2: 調査期間ごとの被攻撃頻度 focal_sum_ntm %&gt;% filter(study_period != &quot;m18&quot;) %&gt;% filter(dur &gt;= 60) %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% pivot_longer(agg_tm:agg_ntm, names_to = &quot;type&quot;, values_to= &quot;agg&quot;) %&gt;% ggplot(aes(x = no_est, y = agg*60/dur, color = type))+ geom_count()+ facet_grid(study_period~type, scales = &quot;free&quot;) focal_sum_ntm %&gt;% filter(study_period != &quot;m18&quot;) %&gt;% filter(dur &gt;= 60) %&gt;% filter(rs2 == &quot;1&quot;) %&gt;% pivot_longer(agg_tm:agg_ntm, names_to = &quot;type&quot;, values_to= &quot;agg&quot;) %&gt;% ggplot(aes(x = no_est, y = agg*60/dur, color = type))+ geom_count()+ facet_grid(study_period~type, scales = &quot;free&quot;) 4.1.3 分析 4.1.3.1 群れオスと群れ外オスの攻撃を区別しない まず、群れオスと群れ外オスの攻撃を区別しないで分析を行う。 4.1.3.1.1 モデリング1(全期間をまとめる) モデルの詳細は以下の通り。なお、群れ外オス数と発情メス数は中心化した。 分布: 負の二項分布 応答変数: 被攻撃回数(no_agg) オフセット項: log(追跡時間)(logdur) 説明変数: 追跡個体の発情の有無(rs2)、観察日の群れ外オス数(cen_ntm)、発情メス数(cen_est)、発情の有無×群れ外オス数、発情の有無×発情メス数、TYの有無(TY)、調査期間(study_period) ランダム切片: 追跡個体ID m_aggfocal &lt;- brm(no_agg ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum, file = &quot;model/m_aggfocal.rds&quot;) 4.1.3.1.1.1 モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99, p-value = 0.826 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal) 4.1.3.1.1.2 結果の確認 発情メス数とTYの有無、発情の有無、調査期間が有意な影響。TYの有無については、TYがいる日は被攻撃頻度が有意に低下する。また、2021年は他の変数を統制したときに2019年より被攻撃頻度が低かったようだ。 model_parameters(m_aggfocal) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と正の関連があった。 estimate_slopes(m_aggfocal, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、発情の有無に限らず被攻撃頻度とは有意な関連がなかった。 estimate_slopes(m_aggfocal, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数に関わりなく非発情メスの方が発情メスよりも被攻撃頻度が有意に低い(図4.3の左)。一方で、発情メス数との関連については、発情メス数が10頭を超えるくらいまでは非発情メスの方が発情メスよりも被攻撃頻度が有意に低い(図4.3の右)。10頭を超えることはまれなので、ほとんどの場合において非発情メスの方が被攻撃頻度は低いといえるだろう。 estimate_contrasts(m_aggfocal, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_ntm estimate_cont_rs_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(focal_sum$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_rs_ntm estimate_contrasts(m_aggfocal, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_est estimate_cont_rs_est %&gt;% mutate(no_est = cen_est + mean(focal_sum$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_rs_est p_cont_rs_ntm + p_cont_rs_est 図4.3: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.1.3.1.2 モデリング2(2019年) 続いて、2019年のデータのみを用いて分析を行う。また、調査期間を説明変数から除き、ITの在/不在もモデルに含める。 focal_sum %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum19 m_aggfocal19 &lt;- brm(no_agg ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum19, file = &quot;model/m_aggfocal19.rds&quot;) 4.1.3.1.2.1 モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal19) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal19) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.97767, p-value = 0.846 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal19) 4.1.3.1.2.2 結果の確認 有意な変数は一つもなかった。 model_parameters(m_aggfocal19) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と有意な関連はなかった。 estimate_slopes(m_aggfocal19, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) これは、群れ外オス数についても同様であった。 estimate_slopes(m_aggfocal19, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.1.3 モデリング3(2020年) 続いて、2020年のデータのみを用いて分析を行う。ITの在/不在もモデルに含める。 focal_sum %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum20 m_aggfocal20 &lt;- brm(no_agg ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum20, file = &quot;model/m_aggfocal20.rds&quot;) 4.1.3.1.3.1 モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal20) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal20) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.96966, p-value = 0.64 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal20) 4.1.3.1.3.2 結果の確認 ITの在/不在と発情の有無が有意な効果。 model_parameters(m_aggfocal20) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と有意な関連はなかった。 estimate_slopes(m_aggfocal20, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) これは、群れ外オス数についても同様であった。 estimate_slopes(m_aggfocal20, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.1.4 モデリング4(2021年) 続いて、2019年のデータのみを用いて分析を行う。また、調査期間を説明変数から除き、ITの在/不在もモデルに含める。 focal_sum %&gt;% filter(study_period == &quot;m21&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum21 m_aggfocal21 &lt;- brm(no_agg ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum21, file = &quot;model/m_aggfocal21.rds&quot;) 4.1.3.1.4.1 モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal21) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal21) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98781, p-value = 0.864 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal21) 4.1.3.1.4.2 結果の確認 発情メス数と発情の有無のみが有意な影響。 model_parameters(m_aggfocal21) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メスのみで被攻撃頻度と有意な関連があった。 estimate_slopes(m_aggfocal21, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数はいずれも有意な影響なし。 estimate_slopes(m_aggfocal21, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.2 群れオス・群れ外オスを区別 続いて、群れオスと群れ外オスの攻撃を区別して分析する。 いずれの分析ではモデルは以下の通りで、群れオス・群れ外オスを区別しない場合と同じである。 分布: 負の二項分布 応答変数: 被攻撃回数(no_agg) オフセット項: log(追跡時間)(logdur) 説明変数: 追跡個体の発情の有無(rs2)、観察日の群れ外オス数(cen_ntm)、発情メス数(cen_est)、発情の有無×群れ外オス数、発情の有無×発情メス数、TYの有無(TY)、調査期間(study_period) ランダム切片: 追跡個体ID 4.1.3.2.1 群れオスからの攻撃頻度 4.1.3.2.1.1 モデリング1(全期間含める) まず、群れオスの攻撃についてモデリングする。 m_aggfocal_tm &lt;- brm(agg_tm ~ cen_est + cen_ntm + rs2 + cen_est:rs2 + cen_ntm:rs2 + TY + IT + study_period + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm, file = &quot;model/m_aggfocal_tm.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98888, p-value = 0.702 ## alternative hypothesis: two.sided ただし、VIFが10以上の変数がある。 check_collinearity(m_aggfocal_tm) 4.1.3.2.1.2 モデリング2(全期間含める) そこで、以下で群れ外オス数と発情メス数についてそれぞれ別のモデルを作成した。 m_aggfocal_tm_est &lt;- brm(agg_tm ~ cen_est + rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm, file = &quot;model/m_aggfocal_tm_est.rds&quot;) m_aggfocal_tm_ntm &lt;- brm(agg_tm ~ cen_ntm + rs2 + cen_ntm:rs2 + TY + study_period + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm, file = &quot;model/m_aggfocal_tm_ntm.rds&quot;) モデルチェック いずれのモデルについても、分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm_est) plotQQunif(check_m_aggfocal_tm_ntm) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm_est) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98876, p-value = 0.704 ## alternative hypothesis: two.sided testZeroInflation(check_m_aggfocal_tm_ntm) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99002, p-value = 0.728 ## alternative hypothesis: two.sided VIFも発情メス数についてはやや高いものの、10以下には収まっている。 # できなくなった? # check_collinearity(m_aggfocal_tm_est) check_collinearity(m_aggfocal_tm_ntm) 結果の確認 いずれのモデルでも、発情の有無と調査期間のみが有意だった。 ### 発情メス数 model_parameters(m_aggfocal_tm_est) ### 群れ外オス数 model_parameters(m_aggfocal_tm_ntm) 交互作用項のある変数の検討を行う。発情メス・非発情メスのいずれについても観察日の発情メス数や群れ外オス数の効果はなかった。 estimate_slopes(m_aggfocal_tm_est, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) estimate_slopes(m_aggfocal_tm_ntm, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数や発情メス数に関わりなく非発情メスの方が発情メスよりも被攻撃頻度が有意に低い(図4.4)。 estimate_contrasts(m_aggfocal_tm_ntm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_tm_ntm estimate_cont_rs_tm_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(focal_sum_ntm$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_rs_tm_ntm estimate_contrasts(m_aggfocal_tm_est, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_tm_est estimate_cont_rs_tm_est %&gt;% mutate(no_est = cen_est + mean(focal_sum_ntm$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_rs_tm_est p_cont_rs_tm_ntm + p_cont_rs_tm_est 図4.4: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.1.3.2.1.3 結果まとめ 群れオスからの攻撃については、発情メス数や群れ外オス数の有意な影響はなかった。 発情の有無のみが明確に影響を与えている要因だった。 4.1.3.2.1.4 モデリング3(2019年) 続いて、調査期間ごとにモデリングする。ITの在/不在をモデルに含める。 focal_sum_ntm %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum_ntm19 m_aggfocal_tm19 &lt;- brm(agg_tm ~ cen_est + cen_ntm + rs2 + cen_est:rs2 + cen_ntm:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm19, file = &quot;model/m_aggfocal_tm19.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm19) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm19) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.97692, p-value = 0.736 ## alternative hypothesis: two.sided VIFも10以下で問題ないよう。 check_collinearity(m_aggfocal_tm19) 結果の確認 有意な変数はなかった。 model_parameters(m_aggfocal_tm19) 交互作用項のある変数の検討を行う。 まず、発情メス数についてはいずれも有意な関連はなかった。 estimate_slopes(m_aggfocal_tm19, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数もいずれも有意な影響なし。 estimate_slopes(m_aggfocal_tm19, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.2.1.5 モデリング4(2020年) ITの在/不在をモデルに含める。 focal_sum_ntm %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum_ntm20 m_aggfocal_tm20 &lt;- brm(agg_tm ~ cen_est + cen_ntm + rs2 + cen_est:rs2 + cen_ntm:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm20, file = &quot;model/m_aggfocal_tm20.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm20) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm20) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.9863, p-value = 0.776 ## alternative hypothesis: two.sided ただし、VIFが高くて多重共線性の問題があるよう。 check_collinearity(m_aggfocal_tm20) 4.1.3.2.1.6 モデリング5(2020年) そこで、交互作用をなくしてモデリングする(交互作用を含めると片方だけの変数を用いても多重共線性の問題は解決されなかった)。 ## 群れ外オス数 m_aggfocal_tm20_b &lt;- brm(agg_tm ~ no_ntm + rs2 + no_est + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm20, file = &quot;model/m_aggfocal_tm20_b.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm20_b) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm20_b) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.9904, p-value = 0.878 ## alternative hypothesis: two.sided VIFも問題ない。 check_collinearity(m_aggfocal_tm20_b) 結果の確認 発情メス数のみが有意な影響。 model_parameters(m_aggfocal_tm20_b) 4.1.3.2.1.7 モデリング6(2021年) focal_sum_ntm %&gt;% filter(study_period == &quot;m21&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm), cen_est = no_est - mean(no_est)) -&gt; focal_sum_ntm21 m_aggfocal_tm21 &lt;- brm(agg_tm ~ cen_est + cen_ntm + rs2 + cen_est:rs2 + cen_ntm:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm21, file = &quot;model/m_aggfocal_tm21.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm21) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm21) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98183, p-value = 0.656 ## alternative hypothesis: two.sided VIFが10以上で多重共線性の問題があるよう。 check_collinearity(m_aggfocal_tm21) 4.1.3.2.1.8 モデリング7(2021年) 発情メス数と発情の有無を除いたモデルにする。 m_aggfocal_tm21_b &lt;- brm(agg_tm ~ cen_ntm*rs2 + no_est + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm21, file = &quot;model/m_aggfocal_tm21_b.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_tm21_b) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_tm21_b) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.9838, p-value = 0.696 ## alternative hypothesis: two.sided VIFも問題なかった。 check_collinearity(m_aggfocal_tm21_b) 結果の確認 有意な変数はなかった。 model_parameters(m_aggfocal_tm21_b) 交互作用項のある変数の検討を行う。 群れ外オス数はいずれも有意な影響なし。 estimate_slopes(m_aggfocal_tm21_b, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.2.2 群れ外オスからの攻撃頻度 4.1.3.2.2.1 モデリング1(全部含める) 続いて、群れ外オスからの攻撃についてモデリングする。 m_aggfocal_ntm &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm, file = &quot;model/m_aggfocal_ntm.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_ntm) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_ntm) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0001, p-value = 1 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal_ntm) 結果の確認 発情メス数、調査期間のみ有意な影響があった。なお、調査期間について2021年が2019年より被攻撃頻度が有意に低かったが、2020年と2019年の違いは有意ではなかった。 model_parameters(m_aggfocal_ntm) TYの有無に関しては、90%確信区間には0は含まれなかった。 model_parameters(m_aggfocal_ntm, ci = 0.9) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と正の関連があった。 estimate_slopes(m_aggfocal_ntm, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、発情メス・非発情メスのいずれについて有意な効果はなかった。 estimate_slopes(m_aggfocal_ntm, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数や発情メス数に関わりなく非発情メスの方と発情メスの被攻撃頻度の差は有意ではなかった(図4.5)。 estimate_contrasts(m_aggfocal_ntm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_ntm_ntm estimate_cont_rs_ntm_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(focal_sum_ntm$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_rs_ntm_ntm estimate_contrasts(m_aggfocal_ntm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_rs_ntm_est estimate_cont_rs_ntm_est %&gt;% mutate(no_est = cen_est + mean(focal_sum_ntm$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_rs_ntm_est p_cont_rs_ntm_ntm + p_cont_rs_ntm_est 図4.5: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.1.3.2.2.2 結果まとめ 群れ外オスからの攻撃については、発情メス・非発情メスともに発情メス数が有意に被攻撃頻度と正に関連していた。 発情の有無による被攻撃頻度の違いはそこまで顕著ではなかった。 TYの有無による被攻撃頻度の違いは有意な傾向。 4.1.3.2.2.3 モデリング2(2019年) 調査期間ごとにモデリングする。 m_aggfocal_ntm19 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm19, file = &quot;model/m_aggfocal_ntm19.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_ntm19) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_ntm19) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98552, p-value = 0.796 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal_ntm19) 結果の確認 有意な変数はなし。 model_parameters(m_aggfocal_ntm19) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と関連がなかった。 estimate_slopes(m_aggfocal_ntm19, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても、発情メス・非発情メスのいずれについても有意な効果はなかった。 estimate_slopes(m_aggfocal_ntm19, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.2.2.4 モデリング3(2020年) 続いて、群れ外オスからの攻撃についてモデリングする。 m_aggfocal_ntm20 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm20, file = &quot;model/m_aggfocal_ntm20.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_ntm20) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_ntm20) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98844, p-value = 0.828 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal_ntm20) 結果の確認 有意な変数はなし。 model_parameters(m_aggfocal_ntm20) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と関連がなかった。 estimate_slopes(m_aggfocal_ntm20, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても、発情メス・非発情メスのいずれについても有意な効果はなかった。 estimate_slopes(m_aggfocal_ntm20, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.1.3.2.2.5 モデリング3(2021年) 続いて、群れ外オスからの攻撃についてモデリングする。 m_aggfocal_ntm21 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + + offset(logdur) + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 21), backend = &quot;cmdstanr&quot;, data = focal_sum_ntm21, file = &quot;model/m_aggfocal_ntm21.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggfocal_ntm21) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggfocal_ntm21) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99437, p-value = 0.926 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggfocal_ntm21) 結果の確認 発情メス数の有意な影響あり。 model_parameters(m_aggfocal_ntm21) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と有意な関連があった。 estimate_slopes(m_aggfocal_ntm21, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても、発情メス・非発情メスのいずれについても有意な効果はなかった。 estimate_slopes(m_aggfocal_ntm21, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2 全生起サンプリングを用いた分析 続いて、全生起サンプリングのデータを用いて同様の分析を行う。 4.2.1 データの加工 6歳以上のメスについて、各メスが確認された時刻から追跡終了までが300分以上のメスのデータのみを用いる。 female_dur %&gt;% filter(!str_detect(study_period,&quot;nm&quot;)) %&gt;% left_join(agg_female_all, by = c(&quot;date&quot;,&quot;femaleID&quot;)) %&gt;% replace_na(list(no_agg = 0)) %&gt;% left_join(agg_female_ntm, by = c(&quot;date&quot;,&quot;femaleID&quot;)) %&gt;% replace_na(list(agg_tm = 0, agg_ntm = 0)) %&gt;% mutate(ok = ifelse(no_agg == agg_tm + agg_ntm,1,0)) %&gt;% left_join(female_all, by = c(&quot;date&quot;, &quot;femaleID&quot;)) %&gt;% filter(dur &gt;= 300) -&gt; agg_ao_all 観察日の群れ外オス数、発情メス数の情報を追加。 ## 群れ外オス数 male_all %&gt;% group_by(date) %&gt;% filter(ntm == &quot;1&quot;) %&gt;% summarise(no_ntm= sum(presence)) %&gt;% ungroup() %&gt;% right_join(agg_ao_all) -&gt; agg_ao_all_b ## 発情メス数 female_all %&gt;% group_by(date) %&gt;% summarise(no_est = sum(rs2, na.rm = TRUE)) %&gt;% ungroup() %&gt;% right_join(agg_ao_all_b) -&gt; agg_ao_all_c TYとITの確認状況を追加する。なお、1時間以上確認できた日を1、1時間未満しか確認できていない日を0とした。 ## 2018 hr18 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2018mating/2018mating_raw.xlsx&quot;, sheet = &quot;male_presence&quot;) %&gt;% select(date,TY,IT) ## 2019 hr19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019mating/2019mating_raw.xlsx&quot;, sheet = &quot;male_presence_anal&quot;) %&gt;% select(date,TY,IT) ## 2020 hr20 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2020mating/2020mating_raw.xlsx&quot;, sheet = &quot;male_presence_anal&quot;) %&gt;% select(date,TY,IT) ## 2021 hr21 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/DoctorStudy/data/2021mating/2021mating_raw.xlsx&quot;, sheet = &quot;male_presence_anal&quot;) %&gt;% select(date,TY) ## 結合して加工 bind_rows(hr18, hr19, hr20, hr21) %&gt;% replace_na(list(IT = 0)) %&gt;% mutate(date = as_date(date))-&gt; hr_presence agg_ao_all_c %&gt;% left_join(hr_presence, by = &quot;date&quot;) -&gt; agg_ao_all_d 各観察日の群れ追跡時間を追加する。また、群れ外オス数と発情メス数を中心化する。 agg_ao_all_d %&gt;% left_join(base_all %&gt;% select(date,duration)) %&gt;% mutate(logdur = log(duration/60)) %&gt;% ungroup() %&gt;% mutate() %&gt;% filter(study_period != &quot;m18&quot;) %&gt;% mutate(cen_est = no_est - mean(no_est), cen_ntm = no_ntm - mean(no_ntm))-&gt; agg_ao_all_fin データは以下の通り。 datatable(agg_ao_all_fin, options = list(scrollX = 30), filter = list(position =&quot;top&quot;)) 4.2.2 データの確認 4.2.2.1 調査年ごとの被攻撃頻度 agg_ao_all_fin %&gt;% pivot_longer(agg_tm:agg_ntm, names_to = &quot;type&quot;, values_to= &quot;agg&quot;) %&gt;% ggplot(aes(x = study_period, y = agg*60/duration))+ geom_violin(aes(fill = type), bw = 0.07, color = &quot;black&quot;, scale = &quot;width&quot;)+ geom_boxplot(aes(color = type), fill = &quot;grey85&quot;, outlier.alpha = 0, width = 0.2, size = 0.2, position = position_dodge(0.9))+ stat_summary(aes(fill = type), fun = &quot;mean&quot;, position = position_dodge(0.9), shape = 18, size = 0.5)+ labs(x = &quot;&quot;, y = &quot;被\\n攻\\n撃\\n頻\\n度\\n(回/h)&quot;, fill = &quot;&quot;, color = &quot;&quot;)+ facet_rep_wrap(~rs2, repeat.tick.labels = TRUE, ncol = 2, labeller = as_labeller(c(&quot;0&quot; = &quot;非発情メス&quot;,&quot;1&quot; = &quot;発情メス&quot;)))+ theme_bw(base_size = 15)+ scale_fill_manual(values = c(&quot;grey54&quot;,&quot;white&quot;), labels = c(&quot;群れ外オス&quot;,&quot;群れオス&quot;))+ scale_color_manual(values = c(&quot;grey10&quot;,&quot;grey10&quot;), labels = c(&quot;群れ外オス&quot;,&quot;群れオス&quot;))+ scale_x_discrete(labels = c(&quot;2018年&quot;,&quot;2019年&quot;,&quot;2020年&quot;,&quot;2021年&quot;))+ theme(aspect.ratio = 0.7, strip.background = element_blank(), strip.text = element_text(family = &quot;Yu Mincho&quot;, hjust = 0), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.title.y = element_text(family = &quot;Yu Mincho&quot;, angle = 0, vjust = 0.5), legend.text = element_text(family = &quot;Yu Mincho&quot;), plot.title = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;)) -&gt; p_aggao_studyperiod # ggsave(&quot;figure/p_aggao_studyperiod.png&quot;, p_aggao_studyperiod, width = 270, height = 110, units = &quot;mm&quot;, dpi = 600) 4.2.2.2 オスごとの攻撃頻度 4.2.2.2.1 データの加工 aggression_all_b %&gt;% drop_na(ntm) %&gt;% mutate(aggressor2 = ifelse(ntm == &quot;0&quot;, aggressor, &quot;NT&quot;)) %&gt;% group_by(date, aggressor2, femaleID) %&gt;% summarise(agg = n()) %&gt;% ungroup() -&gt; aggression_dyad female_dur %&gt;% tidyr::expand(data.frame(maleID = c(&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;NT&quot;)), nesting(date,study_period,femaleID,dur)) %&gt;% left_join(aggression_dyad, by = c(&quot;date&quot;,&quot;maleID&quot; = &quot;aggressor2&quot;,&quot;femaleID&quot;)) %&gt;% replace_na(list(agg = 0)) %&gt;% left_join(hr_presence, by = &quot;date&quot;) %&gt;% mutate(inc = ifelse(maleID == &quot;TY&quot; &amp; TY == &quot;0&quot;|maleID == &quot;IT&quot; &amp; IT == &quot;0&quot;,0,1)) %&gt;% filter(inc == &quot;1&quot;) %&gt;% mutate(inc2 = ifelse(study_period %in% c(&quot;m18&quot;,&quot;m19&quot;,&quot;m20&quot;) &amp; maleID == &quot;KM&quot;| study_period == &quot;m21&quot; &amp; maleID == &quot;IT&quot;| study_period %in% c(&quot;m20&quot;,&quot;m21&quot;) &amp; maleID == &quot;LK&quot;,0,1)) %&gt;% filter(inc2 == &quot;1&quot;) %&gt;% left_join(base_all %&gt;% select(date,duration)) %&gt;% left_join(female_all %&gt;% select(date, femaleID, rs2)) %&gt;% drop_na(rs2) -&gt; aggao_dyad 4.2.2.2.2 図示 N_ao &lt;- aggao_dyad %&gt;% mutate(rs2 = as.factor(rs2)) %&gt;% filter(dur &gt;= 300) %&gt;% filter(duration &gt;= 300) %&gt;% mutate(rate_agg = agg*60/duration) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% mutate(maleID = fct_relevel(maleID,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;NT&quot;)) %&gt;% group_by(study_period, maleID, rs2) %&gt;% summarise(N = n(), y = max(rate_agg + 0.3)) %&gt;% ungroup() aggao_dyad %&gt;% filter(dur &gt;= 300) %&gt;% filter(duration &gt;= 300) %&gt;% mutate(rs2 = as.factor(rs2)) %&gt;% mutate(rate_agg = agg*60/duration) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% mutate(maleID = fct_relevel(maleID,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;,&quot;KM&quot;,&quot;NT&quot;)) %&gt;% ggplot(aes(x = maleID, y = rate_agg))+ geom_violin(aes(fill = rs2), bw = 0.05, color = &quot;black&quot;, scale = &quot;width&quot;)+ geom_boxplot(aes(color = rs2), fill = &quot;grey85&quot;, outlier.alpha = 0, width = 0.25, position = position_dodge(0.9), size = 0.2)+ stat_summary(aes(fill = rs2), fun = &quot;mean&quot;, position = position_dodge(0.9), shape = 18, size = 0.35)+ labs(x = &quot;&quot;, y = &quot;被\\n攻\\n撃\\n頻\\n度\\n(回/h)&quot;, fill = &quot;&quot;, color = &quot;&quot;)+ facet_rep_wrap(~study_period, repeat.tick.labels = TRUE, ncol = 2) + coord_cartesian(ylim = c(0,1))+ theme_bw(base_size = 15)+ scale_fill_manual(values = c(&quot;grey54&quot;,&quot;white&quot;), labels = c(&quot;非発情メス&quot;,&quot;発情メス&quot;))+ scale_color_manual(values = c(&quot;grey10&quot;,&quot;grey10&quot;), labels = c(&quot;非発情メス&quot;,&quot;発情メス&quot;))+ theme(aspect.ratio = 0.5, strip.background = element_blank(), strip.text = element_text(family = &quot;Yu Mincho&quot;, hjust = 0), axis.text.x = element_text(family = &quot;Yu Mincho&quot;), axis.title.y = element_text(family = &quot;Yu Mincho&quot;, angle = 0, vjust = 0.5), legend.text = element_text(family = &quot;Yu Mincho&quot;), axis.text.y = element_text(family = &quot;Times New Roman&quot;)) -&gt; p_aggao_maleID # ggsave(&quot;figure/p_aggao_maleID.png&quot;, p_aggao_maleID, width = 270, height = 130, units = &quot;mm&quot;, dpi = 600) 以下の通り。 図4.6: 調査期間ごとの被攻撃頻度 agg_ao_all_fin %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% pivot_longer(agg_tm:agg_ntm, names_to = &quot;type&quot;, values_to = &quot;agg&quot;) %&gt;% ggplot(aes(x = no_est, y = agg*60/duration))+ geom_count()+ facet_wrap(type~study_period) 4.2.3 分析 4.2.3.1 群れオスと群れ外オスを区別しない まず、群れオスと群れ外オスの攻撃を区別しないで分析を行う。 4.2.3.1.1 モデリング モデルの詳細は以下の通り。なお、群れ外オス数と発情メス数は中心化した。 分布: 負の二項分布 応答変数: 被攻撃回数(no_agg) オフセット項: log(群れ追跡時間)(logdur) 説明変数: 追跡個体の発情の有無(rs2)、観察日の群れ外オス数(cen_ntm)、発情メス数(cen_est)、発情の有無×群れ外オス数、発情の有無×発情メス数、TYの有無(TY)、調査期間(study_period) ランダム切片: メスID(femaleID)、観察日(date) m_aggao &lt;- brm(no_agg ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)), file = &quot;model/m_aggao.rds&quot;) 4.2.3.1.1.1 モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99966, p-value = 0.986 ## alternative hypothesis: two.sided VIFは全て10以下であり、そこまで多重共線性の問題はないよう。 check_collinearity(m_aggao) 4.2.3.1.1.2 結果の確認 発情メス数と群れ外オス数、TYの有無、発情の有無、調査期間が有意な影響。TYの有無については、TYがいる日は被攻撃頻度が有意に低下する。 model_parameters(m_aggao) 交互作用項のある変数の検討を行う。 まず、発情メス数については発情メス・非発情メスのいずれについても被攻撃頻度と正の関連があった。 estimate_slopes(m_aggao, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、発情の有無に限らず被攻撃頻度とは有意な正の関連があった。 estimate_slopes(m_aggao, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数や発情メス数に関わりなく非発情メスの方が発情メスよりも被攻撃頻度が有意に低い(図4.7)。 estimate_contrasts(m_aggao, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_ntm estimate_cont_ao_rs_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(agg_ao_all_fin$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_ao_rs_ntm estimate_contrasts(m_aggao, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_est estimate_cont_ao_rs_est %&gt;% mutate(no_est = cen_est + mean(agg_ao_all_fin$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_ao_rs_est p_cont_ao_rs_ntm + p_cont_ao_rs_est 図4.7: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.2.3.2 群れオス・群れ外オスを区別する 続いて、群れオスと群れ外オスの攻撃を区別して分析する。 いずれの分析ではモデルは以下の通りで、群れオス・群れ外オスを区別しない場合と同じである。 分布: 負の二項分布 応答変数: 被攻撃回数(no_agg) オフセット項: log(追跡時間)(logdur) 説明変数: 追跡個体の発情の有無(rs2)、観察日の群れ外オス数(cen_ntm)、発情メス数(cen_est)、発情の有無×群れ外オス数、発情の有無×発情メス数、TYの有無(TY)、調査期間(study_period) ランダム切片: 追跡個体ID 4.2.3.2.1 群れオスからの攻撃頻度 4.2.3.2.1.1 モデリング まず、群れオスの攻撃についてモデリングする。 m_aggao_tm &lt;- brm(agg_tm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)), file = &quot;model/m_aggao_tm.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_tm) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_tm) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99741, p-value = 0.792 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_tm) 結果の確認 発情メス数と群れ外オス数、TYの有無、発情の有無、調査期間が有意な影響。TYの有無については、TYがいる日は被攻撃頻度が有意に低下する。 model_parameters(m_aggao_tm) 交互作用項のある変数の検討を行う。非発情メスのみで観察日の発情メス数が被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_tm, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても、非発情メスのみで被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_tm, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数や発情メス数に関わりなく非発情メスの方が発情メスよりも被攻撃頻度が有意に低い(図4.8)。 estimate_contrasts(m_aggao_tm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_tm_ntm estimate_cont_ao_rs_tm_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(agg_ao_all_fin$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_ao_rs_tm_ntm estimate_contrasts(m_aggao_tm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_tm_est estimate_cont_ao_rs_tm_est %&gt;% mutate(no_est = cen_est + mean(agg_ao_all_fin$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_ao_rs_tm_est p_cont_rs_tm_ntm + p_cont_rs_tm_est 図4.8: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.2.3.2.1.2 モデリング2(2019年) m_aggao_tm19 &lt;- brm(agg_tm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m19&quot;), file = &quot;model/m_aggao_tm19.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_tm19) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_tm19) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98109, p-value = 0.598 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_tm19) 結果の確認 群れ外オス数、発情の有無、ITの有無が有意な影響。 model_parameters(m_aggao_tm19) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していなかった。 estimate_slopes(m_aggao_tm19, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、いずれも被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_tm19, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2.3.2.1.3 モデリング3(2020年) m_aggao_tm20 &lt;- brm(agg_tm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m20&quot;), file = &quot;model/m_aggao_tm20.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_tm20) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_tm20) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99931, p-value = 0.956 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_tm20) 結果の確認 ITの有無、発情の有無のみが有意な影響。 model_parameters(m_aggao_tm20) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していなかった。 estimate_slopes(m_aggao_tm20, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても同様だった。 estimate_slopes(m_aggao_tm20, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2.3.2.1.4 モデリング4(2021年) m_aggao_tm21 &lt;- brm(agg_tm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m21&quot;), file = &quot;model/m_aggao_tm21.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_tm21) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_tm21) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0009, p-value = 0.992 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_tm21) 結果の確認 発情メス数とTYの有無、発情の有無、発情メス数と発情の有無の交互作用が有意。 model_parameters(m_aggao_tm21) 交互作用項のある変数の検討を行う。非発情メスのみが観察日の発情メス数が被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_tm21, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についてはいずれも有意ではなかった。 estimate_slopes(m_aggao_tm21, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2.3.2.2 群れ外オスからの攻撃頻度 4.2.3.2.2.1 モデリング1(全期間) m_aggao_ntm &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + study_period + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)), file = &quot;model/m_aggao_ntm.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_ntm) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_ntm) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99747, p-value = 0.72 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_ntm) 結果の確認 発情メス数と群れ外オス数、TYの有無、発情の有無、調査期間が有意な影響。TYの有無については、TYがいる日は被攻撃頻度が有意に低下する。 ### 発情メス数 model_parameters(m_aggao_ntm) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数についても、非発情メス・発情メスいずれも被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 発情の有無については、群れ外オス数や発情メス数がそこまで多くなければ非発情メス数の方が発情メスよりも被攻撃頻度が有意に低かった(図4.9)。 estimate_contrasts(m_aggao_ntm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_ntm&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_ntm_ntm estimate_cont_ao_rs_ntm_ntm %&gt;% mutate(no_ntm = cen_ntm + mean(agg_ao_all_fin$no_ntm)) %&gt;% ggplot(aes(x = no_ntm, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of nontroop males&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of nontroop males&quot;) -&gt; p_cont_ao_rs_ntm_ntm estimate_contrasts(m_aggao_ntm, contrast = &quot;rs2 = c(0,1)&quot;, at = c(&quot;cen_est&quot;), length = 30) %&gt;% data.frame() -&gt; estimate_cont_ao_rs_ntm_est estimate_cont_ao_rs_ntm_est %&gt;% mutate(no_est = cen_est + mean(agg_ao_all_fin$no_est)) %&gt;% ggplot(aes(x = no_est, y = Difference))+ geom_line()+ geom_ribbon(aes(ymin = CI_low, ymax = CI_high), alpha = 0.2)+ geom_hline(yintercept = 0, color = &quot;red&quot;)+ theme_bw(base_size = 14)+ theme(aspect.ratio = 1, plot.title = element_text(size = 13))+ scale_x_continuous(breaks = seq(0,13,1))+ labs(title = &quot;Effect of estrous status\\nby number of estrous females&quot;, y = &quot;anesrus - estrous&quot;, x = &quot;no. of estrous females&quot;) -&gt; p_cont_ao_rs_ntm_est p_cont_ao_rs_ntm_ntm + p_cont_ao_rs_ntm_est 図4.9: 群れ外オス数/発情メス数ごとの発情の有無の効果 4.2.3.2.2.2 モデリング2(2019年) m_aggao_ntm19 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m19&quot;), file = &quot;model/m_aggao_ntm19.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_ntm19) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_ntm19) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99291, p-value = 0.794 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_ntm19) 結果の確認 群れ外オス数、TYの有無、ITの有無が有意な影響。 ### 発情メス数 model_parameters(m_aggao_ntm19) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していなかった。 estimate_slopes(m_aggao_ntm19, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、非発情メスのみで被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm19, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2.3.2.2.3 モデリング3(2020年) m_aggao_ntm20 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + IT + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m20&quot;), file = &quot;model/m_aggao_ntm20.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_ntm20) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_ntm20) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99796, p-value = 0.844 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_ntm20) 結果の確認 群れ外オス数、ITの有無、発情の有無、調査期間が有意な影響。 model_parameters(m_aggao_ntm20) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していなかった。 estimate_slopes(m_aggao_ntm20, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、非発情メスのみ被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm20, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) 4.2.3.2.2.4 モデリング4(2021年) m_aggao_ntm21 &lt;- brm(agg_ntm ~ cen_ntm + cen_est + rs2 + cen_ntm:rs2 + cen_est:rs2 + TY + offset(logdur) + (1|femaleID) + (1|date), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,5), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;), prior(gamma(0.01,0.01), class = &quot;shape&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), backend = &quot;cmdstanr&quot;, data = agg_ao_all_fin %&gt;% mutate(date = as.factor(date)) %&gt;% filter(study_period == &quot;m21&quot;), file = &quot;model/m_aggao_ntm21.rds&quot;) モデルチェック 分布から大きく外れていることはなく、過分散や外れ値の問題もないよう。 plotQQunif(check_m_aggao_ntm21) ゼロ過剰の問題もない。 testZeroInflation(check_m_aggao_ntm21) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0011, p-value = 0.976 ## alternative hypothesis: two.sided VIFも10以下には収まっている。 check_collinearity(m_aggao_ntm21) 結果の確認 発情メス数と群れ外オス数、TYの有無、発情の有無、調査期間が有意な影響。 ### 発情メス数 model_parameters(m_aggao_ntm21) 交互作用項のある変数の検討を行う。非発情メス・発情メスいずれも観察日の発情メス数が被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm21, trend = &quot;cen_est&quot;, at = &quot;rs2 = c(0,1)&quot;) 群れ外オス数については、非発情メスのみで被攻撃頻度に有意に影響していた。 estimate_slopes(m_aggao_ntm21, trend = &quot;cen_ntm&quot;, at = &quot;rs2 = c(0,1)&quot;) "],["cohesion_analysis.html", "5 休息中の凝集性に影響する要因 5.1 データの加工 5.2 群れ外オス数やTY、ITの有無と群れ内の凝集性の関連 5.3 各個体追跡セッションを1つのサンプルとする 6 ネットワーク図の作成 6.1 データの加工 6.2 非交尾期との比較", " 5 休息中の凝集性に影響する要因 以下の分析では、オスからの攻撃のリスクが群れの凝集性に影響するかを検討する。 5.1 データの加工 まず、休息集団内のメス数と、3m以内のメス数、5m以内のメス数(2019は除く)を算出する。また、近接に群れオスがいたかを示した列を作成する。 ## 近接メス情報の作成 adult18 &lt;- unique(female18 %&gt;% filter(age &gt;= 6) %&gt;% .$femaleID) adult19 &lt;- unique(female19 %&gt;% filter(age &gt;= 6) %&gt;% .$femaleID) adult20 &lt;- unique(female20 %&gt;% filter(age &gt;= 6) %&gt;% .$femaleID) adult21 &lt;- unique(female21 %&gt;% filter(age &gt;= 6) %&gt;% .$femaleID) focal_raw_fin %&gt;% separate(x0_1m, into = str_c(&quot;x0_1m&quot;,1:11), sep = &quot;,&quot;) %&gt;% separate(x1_3m, into = str_c(&quot;x1_3m&quot;,1:15), sep = &quot;,&quot;) %&gt;% separate(x3_5m, into = str_c(&quot;x3_5m&quot;,1:16), sep = &quot;,&quot;) %&gt;% separate(x5_10m, into = str_c(&quot;x5_10m&quot;, 1:9), sep = &quot;,&quot;) %&gt;% pivot_longer(cols = x0_1m1:x5_10m5, names_to = &quot;proximity&quot;, values_to = &quot;ID&quot;) %&gt;% mutate(proximity = ifelse(str_detect(proximity,&quot;x0_1m&quot;),&quot;x0_1m&quot;, ifelse(str_detect(proximity,&quot;x1_3m&quot;),&quot;x1_3m&quot;, ifelse(str_detect(proximity,&quot;x3_5m&quot;),&quot;x3_5m&quot;, ifelse(str_detect(proximity,&quot;x5_10m&quot;),&quot;x5_10m&quot;,&quot;NA&quot;))))) %&gt;% filter(!is.na(ID)) -&gt; focal_prox ## 休息集団 RG_female &lt;- focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter((study_period == &quot;m18&quot; &amp; ID %in% adult18)|(study_period == &quot;m19&quot; &amp; ID %in% adult19)| (study_period == &quot;m20&quot; &amp; ID %in% adult20)|(study_period == &quot;m21&quot; &amp; ID %in% adult21)) %&gt;% group_by(date, no_focal, time) %&gt;% summarise(RGfemale = n()) %&gt;% ungroup() ## 休息集団内の発情メス数 focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter((study_period == &quot;m18&quot; &amp; ID %in% adult18)|(study_period == &quot;m19&quot; &amp; ID %in% adult19)| (study_period == &quot;m20&quot; &amp; ID %in% adult20)|(study_period == &quot;m21&quot; &amp; ID %in% adult21)) %&gt;% select(date, no_focal, time, ID) %&gt;% left_join(female_all %&gt;% select(date, femaleID, rs2), by = c(&quot;date&quot;,&quot;ID&quot; = &quot;femaleID&quot;)) %&gt;% filter(rs2 == &quot;1&quot;) %&gt;% group_by(date, no_focal, time) %&gt;% summarise(RGest = n()) -&gt; RGest_female ## 休息集団内に各オスがいるか否か RG_TY &lt;- focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;TY&quot;) %&gt;% mutate(RG_TY = 1) %&gt;% select(-ID) RG_IT &lt;- focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;IT&quot;) %&gt;% mutate(RG_IT = 1) %&gt;% select(-ID) RG_LK &lt;- focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;LK&quot;) %&gt;% mutate(RG_LK = 1) %&gt;% select(-ID) RG_KR &lt;- focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;KR&quot;) %&gt;% mutate(RG_KR = 1) %&gt;% select(-ID) ## 3m、5m近接 focal_prox %&gt;% mutate(ID = str_replace(ID, &quot;\\\\(F\\\\)&quot;,&quot;&quot;)) %&gt;% mutate(ID = str_replace(ID, &quot;\\\\(M\\\\)&quot;,&quot;&quot;)) %&gt;% mutate(ID = str_replace(ID, &quot;\\\\(O\\\\)&quot;,&quot;&quot;)) %&gt;% mutate(ID = str_replace(ID, &quot;\\\\(N\\\\)&quot;,&quot;&quot;)) %&gt;% mutate(ID = str_replace(ID, &quot;\\\\(n\\\\)&quot;,&quot;&quot;)) %&gt;% filter((study_period == &quot;m18&quot; &amp; ID %in% adult18)|(study_period == &quot;m19&quot; &amp; ID %in% adult19)| (study_period == &quot;m20&quot; &amp; ID %in% adult20)|(study_period == &quot;m21&quot; &amp; ID %in% adult21)) -&gt; focal_prox_all focal_prox_all %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;,&quot;x1_3m&quot;)) %&gt;% group_by(date, no_focal, time) %&gt;% summarise(x3m_female = n()) %&gt;% ungroup() -&gt; x3m_female focal_prox_all %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;,&quot;x1_3m&quot;,&quot;x3_5m&quot;)) %&gt;% group_by(date, no_focal, time) %&gt;% summarise(x5m_female = n()) %&gt;% ungroup() -&gt; x5m_female ## 元データに結合 focal_raw_fin %&gt;% left_join(RG_female, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RGest_female, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(x3m_female, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(x5m_female, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_TY, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_IT, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_LK, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_KR, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% replace_na(list(RGfemale = 0, RGest = 0, x3m_female = 0, x5m_female =0, RG_TY = 0, RG_IT = 0, RG_LK = 0, RG_KR = 0)) %&gt;% replace_na(list(x0_1m = &quot;NA&quot;,x1_3m = &quot;NA&quot;, x3_5m = &quot;NA&quot;, x5_10m = &quot;NA&quot;)) %&gt;% mutate(RGfemale_plus1 = RGfemale + 1) %&gt;% ## TYとITの情報を追加 mutate(TY_10m = ifelse(str_detect(x0_1m,&quot;TY&quot;)|str_detect(x1_3m,&quot;TY&quot;)|str_detect(x3_5m,&quot;TY&quot;)|str_detect(x5_10m,&quot;TY&quot;),1,0), TY_5m = ifelse(str_detect(x0_1m,&quot;TY&quot;)|str_detect(x1_3m,&quot;TY&quot;)|str_detect(x3_5m,&quot;TY&quot;),1,0), TY_3m = ifelse(str_detect(x0_1m,&quot;TY&quot;)|str_detect(x1_3m,&quot;TY&quot;),1,0)) %&gt;% mutate(IT_10m = ifelse(str_detect(x0_1m,&quot;IT&quot;)|str_detect(x1_3m,&quot;IT&quot;)|str_detect(x3_5m,&quot;IT&quot;)|str_detect(x5_10m,&quot;IT&quot;),1,0), IT_5m = ifelse(str_detect(x0_1m,&quot;IT&quot;)|str_detect(x1_3m,&quot;IT&quot;)|str_detect(x3_5m,&quot;IT&quot;),1,0), IT_3m = ifelse(str_detect(x0_1m,&quot;IT&quot;)|str_detect(x1_3m,&quot;IT&quot;),1,0)) %&gt;% mutate(KR_10m = ifelse(str_detect(x0_1m,&quot;KR&quot;)|str_detect(x1_3m,&quot;KR&quot;)|str_detect(x3_5m,&quot;KR&quot;)|str_detect(x5_10m,&quot;KR&quot;),1,0), KR_5m = ifelse(str_detect(x0_1m,&quot;KR&quot;)|str_detect(x1_3m,&quot;KR&quot;)|str_detect(x3_5m,&quot;KR&quot;),1,0), KR_3m = ifelse(str_detect(x0_1m,&quot;KR&quot;)|str_detect(x1_3m,&quot;KR&quot;),1,0)) %&gt;% mutate(LK_10m = ifelse(str_detect(x0_1m,&quot;LK&quot;)|str_detect(x1_3m,&quot;LK&quot;)|str_detect(x3_5m,&quot;LK&quot;)|str_detect(x5_10m,&quot;LK&quot;),1,0), LK_5m = ifelse(str_detect(x0_1m,&quot;LK&quot;)|str_detect(x1_3m,&quot;LK&quot;)|str_detect(x3_5m,&quot;LK&quot;),1,0), LK_3m = ifelse(str_detect(x0_1m,&quot;LK&quot;)|str_detect(x1_3m,&quot;LK&quot;),1,0)) %&gt;% left_join(base_all %&gt;% select(date,temp_am,temp_pm)) -&gt; focal_raw_prox その日群れ内にいた血縁個体数を書く。 kin &lt;- read_csv(&quot;data/kin.csv&quot;) focal_raw_fin %&gt;% distinct(study_period, date,no_focal, subject) %&gt;% left_join(female_all %&gt;% select(date, femaleID, presence)) %&gt;% filter(!(subject == femaleID)) %&gt;% left_join(kin, by = c(&quot;study_period&quot;, &quot;subject&quot;,&quot;femaleID&quot;)) %&gt;% mutate(kin_presence = ifelse(presence == &quot;1&quot; &amp; kin &gt; 0.0625,1,0)) %&gt;% left_join(att, by = c(&quot;study_period&quot;,&quot;femaleID&quot;)) %&gt;% filter(age &gt;= 6) %&gt;% group_by(no_focal, date, subject) %&gt;% summarise(no_kin = sum(kin_presence)) %&gt;% ungroup() -&gt; focal_numkin focal_raw_prox %&gt;% left_join(focal_numkin, by = c(&quot;no_focal&quot;,&quot;date&quot;,&quot;subject&quot;)) -&gt; focal_raw_prox_b その日観察したオトナメスへの攻撃頻度も追加する。各観察日に観察された群れオス/群れ外オスからの攻撃の頻度を算出し、個体追跡データにくっつける。 aggression_all %&gt;% left_join(males, by = c(&quot;aggressor&quot; = &quot;maleID&quot;,&quot;study_period&quot;)) %&gt;% drop_na(ntm) %&gt;% group_by(date, ntm) %&gt;% summarise(agg = n()) %&gt;% ungroup() %&gt;% pivot_wider(names_from = ntm, values_from = agg) %&gt;% rename(&quot;agg_tm&quot; = 2, &quot;agg_ntm&quot; = 3) %&gt;% left_join(base_all %&gt;% select(date, duration)) %&gt;% filter(duration &gt;= 300) %&gt;% replace_na(list(agg_tm = 0, agg_ntm = 0)) %&gt;% mutate(rate_tm = agg_tm*60/duration, rate_ntm = agg_ntm*60/duration) -&gt; aggression_daily aggression_all %&gt;% group_by(date) %&gt;% summarise(agg = n()) %&gt;% ungroup() %&gt;% left_join(base_all %&gt;% select(date, duration)) %&gt;% filter(duration &gt;= 300) %&gt;% replace_na(list(agg = 0)) %&gt;% mutate(rate_agg = agg*60/duration) -&gt; aggression_daily_all focal_raw_prox_b %&gt;% left_join(aggression_daily, by = &quot;date&quot;) %&gt;% left_join(aggression_daily_all, by = &quot;date&quot;) -&gt; focal_raw_prox_fin 作成したデータは以下の通り。 datatable(focal_raw_prox_fin, options = list(scrollX = 80), filter = list(position = &quot;top&quot;)) 5.2 群れ外オス数やTY、ITの有無と群れ内の凝集性の関連 まず、5分ごとの休息集団サイズをしようして分析を行う。 5.2.1 データの加工 5分ごとの休息集団サイズを抽出する。なお、以下の条件を満たすもののみを抽出した。 6歳以上のメスが50%以上観察できたときのみのデータを使用する。 3位以下のオスまたは群れ外オスとコンソートしていた個体追跡セッションは除外した。 focal_raw_prox_fin %&gt;% mutate(rate_female = no_female/max_female) %&gt;% filter(max_female &gt;= 0.5) %&gt;% filter(consort &lt;= 2) %&gt;% replace_na(list(hud = 0)) %&gt;% filter(hud != &quot;1&quot;) %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(time %% 5 == 0) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm, na.rm = TRUE)) %&gt;% mutate(N = 1:n()) %&gt;% mutate(TY2 = ifelse(TY == &quot;1&quot; &amp; TY_10m == &quot;1&quot;, &quot;a&quot;, ifelse(TY == &quot;1&quot; &amp; TY_10m == &quot;0&quot;, &quot;b&quot;, ifelse(TY == &quot;0&quot;, &quot;c&quot;, &quot;NA&quot;)))) -&gt; focal_rest focal_raw_prox_fin %&gt;% filter(activity == &quot;F&quot; &amp; T_G == &quot;G&quot;) %&gt;% mutate(rate_female = no_female/max_female) %&gt;% filter(max_female &gt;= 0.5) %&gt;% filter(consort &lt;= 2) %&gt;% replace_na(list(hud = 0)) %&gt;% filter(time %% 5 == 0) %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% mutate(cen_ntm = no_ntm - mean(no_ntm, na.rm = TRUE)) %&gt;% mutate(N = 1:n()) %&gt;% mutate(TY2 = ifelse(TY == &quot;1&quot; &amp; TY_10m == &quot;1&quot;, &quot;a&quot;, ifelse(TY == &quot;1&quot; &amp; TY_10m == &quot;0&quot;, &quot;b&quot;, ifelse(TY == &quot;0&quot;, &quot;c&quot;, &quot;NA&quot;)))) -&gt; focal_feed focal_feed %&gt;% ggplot(aes(x = no_ntm, y = x3m_female/no_female-1))+ geom_count()+ facet_wrap(study_period~TY)+ geom_smooth(method = &quot;glm&quot;) 5.3 各個体追跡セッションを1つのサンプルとする 各個体追跡セッションにおける平均休息集団サイズと平均周辺個体数を算出する。ただし、少なくとも地上での休息が10分以上ある日のみを抽出する。 focal_raw_prox_fin %&gt;% filter(study_period != &quot;m18&quot;) %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% mutate(TY = as.factor(TY), IT = as.factor(IT)) %&gt;% ungroup() %&gt;% group_by(no_focal, subject, date, consort, rs2, TY, IT, no_ntm, no_est, study_period, no_female, rate_agg, rate_ntm, rate_tm, no_kin, temp_am) %&gt;% summarise(N = n(), sum = sum(RGfemale+1, na.rm = TRUE), max = max(RGfemale+1), sum_5m = sum(x5m_female, na.rm = TRUE), sum_TY10m = sum(TY_10m), sum_TY3m = sum(TY_3m)) %&gt;% ungroup() %&gt;% filter(consort &lt;= 2, N &gt;= 15) %&gt;% replace_na(list(IT = &quot;0&quot;)) %&gt;% filter(TY != &quot;2&quot; &amp; IT != &quot;2&quot;) %&gt;% mutate(cen_ntm = no_ntm- mean(no_ntm, na.rm = TRUE), cen_est = no_est - mean(no_est, na.rm = TRUE), logN = log(N)) -&gt; RGsize_sum 6 ネットワーク図の作成 6.1 データの加工 focal_prox %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter((study_period == &quot;m18&quot; &amp; ID %in% c(adult18,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;))|(study_period == &quot;m19&quot; &amp; ID %in% c(adult19,&quot;TY&quot;,&quot;IT&quot;,&quot;LK&quot;,&quot;KR&quot;))|(study_period == &quot;m20&quot; &amp; ID %in% c(adult20,&quot;TY&quot;,&quot;IT&quot;,&quot;KR&quot;))|(study_period == &quot;m21&quot; &amp; ID %in% c(adult21,&quot;TY&quot;,&quot;KR&quot;,&quot;KM&quot;))) %&gt;% select(date, no_focal, time, subject, ID) %&gt;% filter(time %% 5 == 0) %&gt;% mutate(presence = 1) -&gt; RGmember RGmember %&gt;% tidyr::expand(nesting(date,no_focal,subject,time), ID) %&gt;% left_join(RGmember, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;subject&quot;,&quot;time&quot;,&quot;ID&quot;)) %&gt;% mutate(presence = ifelse(subject == ID, 1,presence)) %&gt;% replace_na(list(presence = 0)) %&gt;% mutate(N = str_c(no_focal,&quot;-&quot;,time)) %&gt;% pivot_wider(names_from = ID, values_from = presence) %&gt;% left_join(focal_raw_fin %&gt;% select(no_focal,time, subject,rs2,TY,IT) %&gt;% rename(TYpre = TY, ITpre = IT), by = c(&quot;no_focal&quot;,&quot;subject&quot;,&quot;time&quot;)) %&gt;% filter(rs2 == &quot;0&quot;) -&gt; RG_gbi ## 2018 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m18&quot;)) %&gt;% select(-(1:5), -Coc,-Anz,-Har,-KM,-Ntm,-Trt,-rs2,-Mif,-TYpre,-ITpre) -&gt; gbi_2018 matRG_2018 &lt;- get_network(gbi_2018, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 21 x 21 matrix met.eigen(matRG_2018) ## Aka Ako Hen Hot IT Kil Kit ## 0.44078775 0.47183370 0.31972946 0.41944298 0.25346097 0.83048114 0.58387368 ## Koh Kol KR Kun Kur LK Mal ## 0.75431489 0.64058728 0.02860217 0.61926988 0.87827233 0.38294383 0.72605090 ## Mei Mik Ntr Tam Ten Tot TY ## 0.27475990 0.80792080 0.46424166 0.47005754 0.72348355 0.56421162 1.00000000 ## 2019 ### TY不在 vs TY在 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m19&quot;)) %&gt;% filter(TYpre == &quot;1&quot; &amp; ITpre == &quot;1&quot;) %&gt;% select(-(1:5), -Coc,-Anz,-Har,-KM,-Ntm,-Trt,-rs2,-TYpre, -ITpre, -IT) -&gt; gbi_2019_TY matRG_2019TY &lt;- get_network(gbi_2019_TY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 21 x 21 matrix met.eigen(matRG_2019TY) ## Aka Ako Hen Hot Kil Kit Koh ## 0.39982475 0.24852013 1.00000000 0.30555917 0.88950093 0.47231021 0.93226198 ## Kol KR Kun Kur LK Mal Mei ## 0.86725969 0.03244162 0.52290618 0.00000000 0.00000000 0.95549435 0.79098273 ## Mif Mik Ntr Tam Ten Tot TY ## 0.74312158 0.88999037 0.38652124 0.11942216 0.38221904 0.15950829 0.54155559 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m19&quot;)) %&gt;% filter(TYpre == &quot;0&quot;) %&gt;% select(-(1:5), -Coc,-Anz,-Har,-KM,-Ntm,-Trt,-rs2,-TYpre, -ITpre, -IT, -TY) -&gt; gbi_2019_notTY matRG_2019notTY &lt;- get_network(gbi_2019_notTY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 20 x 20 matrix met.eigen(matRG_2019notTY) ## Aka Ako Hen Hot Kil Kit Koh Kol ## 0.2401426 0.1963205 0.4653405 0.5375263 0.7338110 0.8895349 0.6565876 1.0000000 ## KR Kun Kur LK Mal Mei Mif Mik ## 0.1165402 0.3961335 0.0000000 0.9905986 0.6208118 0.6184282 0.6010717 0.2857917 ## Ntr Tam Ten Tot ## 0.5298359 0.7081603 0.7753288 0.9228832 ## 2020 ### TY不在 vs TY在 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m20&quot;)) %&gt;% filter(TYpre == &quot;1&quot;) %&gt;% select(-(1:5), -Har,-KM,-rs2,-TYpre, -ITpre, -IT, -LK) -&gt; gbi_2020_TY matRG_2020TY &lt;- get_network(gbi_2020_TY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 24 x 24 matrix met.eigen(matRG_2020TY) ## Aka Ako Anz Coc Hen Hot Kil ## 0.00000000 0.00000000 0.07089038 0.87084799 0.19866119 0.91294260 0.44416003 ## Kit Koh Kol KR Kun Kur Mal ## 0.57812081 0.37103268 0.76766668 0.00000000 0.25137436 0.00000000 0.25262425 ## Mei Mif Mik Ntm Ntr Tam Ten ## 0.13500953 0.02209585 0.29473435 0.63322605 0.30746584 0.68712767 0.67249626 ## Tot Trt TY ## 1.00000000 0.15621231 0.36948945 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m20&quot;)) %&gt;% filter(TYpre == &quot;0&quot;) %&gt;% select(-(1:5), -Har,-KM,-rs2,-TYpre, -ITpre, -IT, -TY, -LK) -&gt; gbi_2020_notTY matRG_2020notTY &lt;- get_network(gbi_2020_notTY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 23 x 23 matrix met.eigen(matRG_2020notTY) ## Aka Ako Anz Coc Hen Hot Kil Kit ## 0.4364763 0.2508912 0.4364763 0.7148038 0.8460359 0.2039867 0.6239721 0.5441316 ## Koh Kol KR Kun Kur Mal Mei Mif ## 0.7603631 0.9002807 0.3804224 0.9314443 0.0000000 0.5071959 0.7766237 0.1202806 ## Mik Ntm Ntr Tam Ten Tot Trt ## 0.5498779 0.2749963 0.2467659 0.8467572 0.5800646 0.4293328 1.0000000 ## 2021年 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m21&quot;)) %&gt;% filter(TYpre == &quot;1&quot;) %&gt;% select(-(1:5), -rs2,-TYpre, -ITpre, -IT,-LK) -&gt; gbi_2021_TY matRG_2021TY &lt;- get_network(gbi_2021_TY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 26 x 26 matrix met.eigen(matRG_2021TY) ## Aka Ako Anz Coc Har Hen Hot Kil ## 0.8213049 0.9689298 0.9881820 0.5227686 0.5434123 0.5817776 0.1994730 0.7261036 ## Kit KM Koh Kol KR Kun Kur Mal ## 0.7744413 0.4688798 0.8778040 0.7438696 0.9176916 0.7494463 0.0000000 0.1876442 ## Mei Mif Mik Ntm Ntr Tam Ten Tot ## 0.7084668 0.5215743 0.4097817 0.6863208 0.7473281 0.0000000 0.6263100 0.4299243 ## Trt TY ## 0.8360327 1.0000000 RG_gbi %&gt;% filter(str_detect(no_focal,&quot;m21&quot;)) %&gt;% filter(TYpre == &quot;0&quot;) %&gt;% select(-(1:5), -rs2,-TYpre, -ITpre, -IT, -TY,-LK) -&gt; gbi_2021_notTY matRG_2021notTY &lt;- get_network(gbi_2021_notTY, data_format = &quot;GBI&quot;, association_index = &quot;HWI&quot;) ## Generating 25 x 25 matrix met.eigen(matRG_2021notTY) ## Aka Ako Anz Coc Har Hen Hot ## 0.00000000 0.09823517 0.04713812 0.85441085 0.01959088 0.47293350 0.09723847 ## Kil Kit KM Koh Kol KR Kun ## 0.55589108 0.52374994 0.00000000 1.00000000 0.93466628 0.65137452 0.82855677 ## Kur Mal Mei Mif Mik Ntm Ntr ## 0.00000000 0.33450495 0.05723267 0.15484161 0.00000000 0.56164448 0.38655585 ## Tam Ten Tot Trt ## 0.00000000 0.44946138 0.21034578 0.03208237 6.2 非交尾期との比較 6.2.1 データの加工 まず、非交尾期のデータを読み込む。今回は2019年のみ。 female19_nm %&gt;% group_by(date) %&gt;% summarise(no_female = sum(presence)) %&gt;% ungroup() -&gt; no_female_nm focal_raw_nm19 &lt;- read_excel(&quot;C:/Users/Tsubasa Yamaguchi/Desktop/Study/data/2019nonmating/2019nonmating_raw.xlsx&quot;, sheet = &quot;focal_raw&quot;, col_types = c(rep(&quot;numeric&quot;,2),rep(&quot;date&quot;,1),rep(&quot;text&quot;,1),rep(&quot;numeric&quot;,2), rep(&quot;text&quot;,2), rep(&quot;numeric&quot;,2),rep(&quot;text&quot;,21),&quot;numeric&quot;,&quot;text&quot;, rep(&quot;numeric&quot;,3))) %&gt;% mutate(study_period = &quot;nm19&quot;) %&gt;% mutate(RG = ifelse(activity %in% c(&quot;R&quot;,&quot;G&quot;) &amp; TG == &quot;G&quot;,1,0)) %&gt;% left_join(no_female_nm) focal_raw_nm19 %&gt;% pivot_longer(cols = x0_1m:x5_10m, names_to = &quot;proximity&quot;,values_to = &quot;ID&quot;) %&gt;% mutate(proximity = ifelse(str_detect(proximity,&quot;x0_1m&quot;),&quot;x0_1m&quot;, ifelse(str_detect(proximity,&quot;x1_3m&quot;),&quot;x1_3m&quot;, ifelse(str_detect(proximity,&quot;x3_5m&quot;),&quot;x3_5m&quot;, ifelse(str_detect(proximity,&quot;x5_10m&quot;),&quot;x5_10m&quot;,&quot;NA&quot;))))) %&gt;% filter(!is.na(ID)) -&gt; focal_raw_prox_nm19 休息中に近接にオスがいる時間割合を算出する。算出するのは休息集団にTYがいる割合と3m以内にTYがいる割合である。 休息集団内 ## TY focal_raw_prox_nm19 %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;TY&quot;) %&gt;% mutate(RG_TY = 1) %&gt;% select(-ID) -&gt; RG_TYnm ## IT focal_raw_prox_nm19 %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;IT&quot;) %&gt;% mutate(RG_IT = 1)%&gt;% select(-ID) -&gt; RG_ITnm ## LK focal_raw_prox_nm19 %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;LK&quot;) %&gt;% mutate(RG_LK = 1)%&gt;% select(-ID) -&gt; RG_LKnm ## LR focal_raw_prox_nm19 %&gt;% filter(RG == &quot;1&quot;) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(ID == &quot;KR&quot;) %&gt;% mutate(RG_KR = 1)%&gt;% select(-ID) -&gt; RG_KRnm 休息集団内のメス数も算出する。 RG_femalenm &lt;- focal_raw_prox_nm19 %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(ID %in% adult18) %&gt;% group_by(date, no_focal, time) %&gt;% summarise(RGfemale = n()) %&gt;% ungroup() 3m近接 focal_raw_prox_nm19 %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;, &quot;x1_3m&quot;)) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(str_detect(ID, &quot;TY&quot;)) %&gt;% mutate(TY_3m = 1)%&gt;% select(-ID) -&gt; TY_3m_nm focal_raw_prox_nm19 %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;, &quot;x1_3m&quot;)) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(str_detect(ID, &quot;IT&quot;)) %&gt;% mutate(IT_3m = 1)%&gt;% select(-ID) -&gt; IT_3m_nm focal_raw_prox_nm19 %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;, &quot;x1_3m&quot;)) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(str_detect(ID, &quot;LK&quot;)) %&gt;% mutate(LK_3m = 1)%&gt;% select(-ID) -&gt; LK_3m_nm focal_raw_prox_nm19 %&gt;% filter(proximity %in% c(&quot;x0_1m&quot;, &quot;x1_3m&quot;)) %&gt;% select(date, no_focal, time, ID) %&gt;% filter(str_detect(ID, &quot;KR&quot;)) %&gt;% mutate(KR_3m = 1)%&gt;% select(-ID) -&gt; KR_3m_nm 全て結合する。 focal_raw_nm19 %&gt;% left_join(RG_TYnm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_ITnm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_LKnm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_KRnm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(TY_3m_nm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(IT_3m_nm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(LK_3m_nm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(KR_3m_nm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% left_join(RG_femalenm, by = c(&quot;date&quot;,&quot;no_focal&quot;,&quot;time&quot;)) %&gt;% replace_na(list(RGfemale = 0, RG_TY = 0, RG_IT = 0, RG_LK = 0, RG_KR = 0, TY_3m = 0, IT_3m = 0, LK_3m = 0, KR_3m = 0)) %&gt;% mutate(no_focal = str_c(study_period, &quot;_&quot;, no_focal)) -&gt; focal_raw_nm19_fin データは以下の通り。 datatable(focal_raw_nm19_fin, options = list(scrollX = 80), filter = list(position = &quot;top&quot;)) 6.2.2 分析 6.2.2.1 休息集団内にオスがいた割合の比較 6.2.2.1.1 割合の算出 まず、非交尾期と交尾期のそれぞれについて休息集団内に各オスがいた割合を算出する。なお、少なくとも地上休息/毛づくろいが3ポイント以上続いた場合のみを抽出する。サル団子場面は外す。 すくなとも15ポイント以上あるデータのみを使用。 focal_raw_nm19_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(hud != &quot;1&quot;) %&gt;% group_by(no_focal, subject, study_period, date) %&gt;% summarise(N = n(), rate_TY = mean(RG_TY), sum_TY = sum(RG_TY), rate_IT = mean(RG_IT), sum_IT= sum(RG_IT), rate_LK = mean(RG_LK), sum_LK = sum(RG_LK), rate_KR = mean(RG_KR), sum_KR = sum(RG_KR)) %&gt;% ungroup() %&gt;% filter(N &gt;= 15) -&gt; focal_RG_sum_nm 交尾期でも同様に算出。交尾期は非発情メスを追跡した日のみを使用する。 focal_raw_prox_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% group_by(no_focal, subject, study_period, TY, IT, date) %&gt;% summarise(N = n(), rate_TY = mean(RG_TY), sum_TY = sum(RG_TY), rate_IT = mean(RG_IT), sum_IT= sum(RG_IT), rate_LK = mean(RG_LK), sum_LK = sum(RG_LK), rate_KR = mean(RG_KR), sum_KR = sum(RG_KR)) %&gt;% ungroup() %&gt;% filter(N &gt;= 15) -&gt; focal_RG_sum データを結合する。 bind_rows(focal_RG_sum, focal_RG_sum_nm) %&gt;% replace_na(list(TY = 1, IT = 1)) %&gt;% mutate(date = as.factor(date)) %&gt;% mutate(season = ifelse(str_detect(study_period,&quot;nm&quot;),&quot;nm&quot;,&quot;m&quot;))-&gt; focal_RG_sum_all 6.2.2.1.2 データの確認 focal_RG_sum_all %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(N &gt;= 10) %&gt;% ggplot(aes(x = study_period, y = rate_TY))+ geom_violin(scale = &quot;width&quot;, bw = 0.02) 6.2.2.1.3 分析 6.2.2.1.3.1 TY まずはTYから分析する。 モデリング 調査期間を説明変数、追跡個体名と日にちをランダム切片に入れる。 focal_RG_sum_TY &lt;- focal_RG_sum_all %&gt;% filter(TY == &quot;1&quot;) ## 調査期間ごと m_RG_TYcomp &lt;- brm(data = focal_RG_sum_TY, sum_TY|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_TYcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_TYcomp) testZeroInflation(check_RG_TYcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99002, p-value = 0.946 ## alternative hypothesis: two.sided 結果の確認 非交尾期は2018交尾期と2019交尾期、2021年交尾期に比べると、休息集団にTYがいる割合が有意に少ない。 estimate_contrasts(m_RG_TYcomp, contrast = &quot;study_period&quot;) 6.2.2.1.3.2 IT モデリング focal_RG_sum_IT &lt;- focal_RG_sum_all %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(study_period != &quot;m21&quot;) ## 調査期間ごと m_RG_ITcomp &lt;- brm(data = focal_RG_sum_IT, sum_IT|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_ITcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_ITcomp) testZeroInflation(check_RG_ITcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98884, p-value = 0.886 ## alternative hypothesis: two.sided 結果の確認 いずれの違いも有意ではないよう。 estimate_contrasts(m_RG_ITcomp, contrast = &quot;study_period&quot;) 6.2.2.1.3.3 LK モデリング 説明変数を調査期間にしたものと、 focal_RG_sum_LK &lt;- focal_RG_sum_all %&gt;% filter(study_period != &quot;m21&quot; &amp; study_period != &quot;m20&quot;) ## 調査期間ごと m_RG_LKcomp &lt;- brm(data = focal_RG_sum_LK, sum_LK|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_LKcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_LKcomp) testZeroInflation(check_RG_LKcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99989, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 交尾期は非交尾期よりもLKが休息集団に含まれる割合が高い。 estimate_contrasts(m_RG_LKcomp, contrast = &quot;study_period&quot;) 6.2.2.1.3.4 KR モデリング 説明変数を調査期間にしたものと、 ## 調査期間ごと m_RG_KRcomp &lt;- brm(data = focal_RG_sum_all, sum_KR|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_KRcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_KRcomp) testZeroInflation(check_RG_KRcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99773, p-value = 0.972 ## alternative hypothesis: two.sided 結果の確認 2020年、2021年の交尾期は非交尾期よりKRが休息集団にいる割合が多いよう。 estimate_contrasts(m_RG_KRcomp, contrast = &quot;study_period&quot;) 6.2.2.1.3.5 交尾期内でのオス間の比較 データの加工 縦長のデータにする。 focal_RG_sum_all %&gt;% select(-rate_TY, -rate_IT, -rate_LK, -rate_KR) %&gt;% pivot_longer(cols = c(sum_TY, sum_IT, sum_LK, sum_KR), names_to = &quot;maleID&quot;, values_to = &quot;sum&quot;) -&gt; focal_RG_sum_long モデリング 調査年ごとに分けてモデリングを行う。 2018年 focal_RG_sum_long %&gt;% filter(study_period == &quot;m18&quot;) -&gt; focal_RG_sum_long18 m_RG_malecomp18 &lt;- brm(data = focal_RG_sum_long18, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp18&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp18) testZeroInflation(check_RG_malecomp18) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99138, p-value = 0.932 ## alternative hypothesis: two.sided 結果の確認 休息集団にいる割合はTY &gt; IT・LK &gt; KR estimate_contrasts(m_RG_malecomp18, contrast = &quot;maleID&quot;) 2019年 TYがいる日のTY、LK、KRの比較と、ITがいる日のIT、LK、KRの比較、どちらもいる日の全個体の比較を行う。 TYがいる日 focal_RG_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot;) -&gt; focal_RG_sum_long19_TY m_RG_malecomp19_TY &lt;- brm(data = focal_RG_sum_long19_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp19_TY&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp19_TY) testZeroInflation(check_RG_malecomp19_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0104, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 TY &gt; LK・KR estimate_contrasts(m_RG_malecomp19_TY, contrast = &quot;maleID&quot;) ITがいる日 focal_RG_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_TY&quot;) -&gt; focal_RG_sum_long19_IT m_RG_malecomp19_IT &lt;- brm(data = focal_RG_sum_long19_IT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp19_IT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp19_IT) testZeroInflation(check_RG_malecomp19_IT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 ITとKRの間のみ有意な差。 estimate_contrasts(m_RG_malecomp19_IT, contrast = &quot;maleID&quot;) どちらもいる日 focal_RG_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(IT == &quot;1&quot; &amp; TY == &quot;1&quot;) -&gt; focal_RG_sum_long19_TYIT m_RG_malecomp19_TYIT &lt;- brm(data = focal_RG_sum_long19_TYIT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp19_TYIT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp19_TYIT) testZeroInflation(check_RG_malecomp19_TYIT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98386, p-value = 0.952 ## alternative hypothesis: two.sided 結果の確認 LKとKRの差以外は有意。TY &gt; IT &gt; LK・KR。 estimate_contrasts(m_RG_malecomp19_TYIT, contrast = &quot;maleID&quot;) 2020年 TYがいる日のTY、KRの比較と、ITがいる日のIT、KRの比較を行う。どちらもいる日は6サンプルしかないため比較は行わない。 TYがいる日 focal_RG_sum_long %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot;) %&gt;% filter(maleID != &quot;sum_LK&quot;) -&gt; focal_RG_sum_long20_TY m_RG_malecomp20_TY &lt;- brm(data = focal_RG_sum_long20_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp20_TY&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp20_TY) testZeroInflation(check_RG_malecomp20_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0121, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 TY &gt; KR。 estimate_contrasts(m_RG_malecomp20_TY, contrast = &quot;maleID&quot;) ITがいる日 focal_RG_sum_long %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_TY&quot;)%&gt;% filter(maleID != &quot;sum_LK&quot;) -&gt; focal_RG_sum_long20_IT m_RG_malecomp20_IT &lt;- brm(data = focal_RG_sum_long20_IT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp20_IT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_RG_malecomp20_IT) testZeroInflation(check_RG_malecomp20_IT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0003, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 有意な差はなし。 estimate_contrasts(m_RG_malecomp20_IT, contrast = &quot;maleID&quot;) 2021年 TYがいる日のTY、KRの比較を行う。 focal_RG_sum_long %&gt;% filter(study_period == &quot;m21&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot; &amp; maleID != &quot;sum_LK&quot;) -&gt; focal_RG_sum_long21_TY m_RG_malecomp21_TY &lt;- brm(data = focal_RG_sum_long21_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_RG_malecomp21_TY&quot;) モデルチェック 少し当てはまりが悪いよう。 plot(check_RG_malecomp21_TY) testZeroInflation(check_RG_malecomp21_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0217, p-value = 0.854 ## alternative hypothesis: two.sided 結果の確認 TY &gt; KR。 estimate_contrasts(m_RG_malecomp21_TY, contrast = &quot;maleID&quot;) 6.2.2.2 3m以内にオスがいた割合の比較 6.2.2.2.1 割合の算出 まず、非交尾期と交尾期のそれぞれについて休息集団内に各オスがいた割合を算出する。なお、少なくとも地上休息/毛づくろいが3ポイント以上続いた場合のみを抽出する。 focal_raw_nm19_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(hud != &quot;1&quot;) %&gt;% group_by(no_focal, subject, study_period, date) %&gt;% summarise(N = n(), rate_TY = mean(TY_3m), sum_TY = sum(TY_3m), rate_IT = mean(IT_3m), sum_IT= sum(IT_3m), rate_LK = mean(LK_3m), sum_LK = sum(LK_3m), rate_KR = mean(KR_3m), sum_KR = sum(KR_3m)) %&gt;% ungroup()%&gt;% filter(N &gt;= 15) -&gt; focal_3m_sum_nm 交尾期でも同様に算出。交尾期は非発情メスを追跡した日のみを使用する。 focal_raw_prox_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% group_by(no_focal, subject, study_period, TY, IT, date) %&gt;% summarise(N = n(), rate_TY = mean(TY_3m), sum_TY = sum(TY_3m), rate_IT = mean(IT_3m), sum_IT= sum(IT_3m), rate_LK = mean(LK_3m), sum_LK = sum(LK_3m), rate_KR = mean(KR_3m), sum_KR = sum(KR_3m)) %&gt;% ungroup()%&gt;% filter(N &gt;= 15) -&gt; focal_3m_sum データを結合する。 bind_rows(focal_3m_sum, focal_3m_sum_nm) %&gt;% replace_na(list(TY = 1, IT = 1)) %&gt;% mutate(date = as.factor(date)) %&gt;% mutate(season = ifelse(str_detect(study_period,&quot;nm&quot;),&quot;nm&quot;,&quot;m&quot;))-&gt; focal_3m_sum_all 6.2.2.2.2 データの確認 focal_3m_sum_all %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(N &gt;= 10) %&gt;% ggplot(aes(x = study_period, y = rate_TY))+ geom_violin(scale = &quot;width&quot;, bw = 0.02) 6.2.2.2.3 分析 6.2.2.2.3.1 TY まずはTYから分析する。 モデリング 調査期間を説明変数、追跡個体名と日にちをランダム切片に入れる。 focal_3m_sum_TY &lt;- focal_3m_sum_all %&gt;% filter(TY == &quot;1&quot;) ## 調査期間ごと m_3m_TYcomp &lt;- brm(data = focal_3m_sum_TY, sum_TY|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_TYcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_TYcomp) testZeroInflation(check_3m_TYcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98875, p-value = 0.922 ## alternative hypothesis: two.sided 結果の確認 非交尾期は2018交尾期と2019交尾期、2021年交尾期に比べると、3m以内にTYがいる割合が有意に少ない。 estimate_contrasts(m_3m_TYcomp, contrast = &quot;study_period&quot;) 6.2.2.2.3.2 IT モデリング focal_3m_sum_IT &lt;- focal_3m_sum_all %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(study_period != &quot;m21&quot;) ## 調査期間ごと m_3m_ITcomp &lt;- brm(data = focal_3m_sum_IT, sum_IT|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_ITcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_ITcomp) testZeroInflation(check_3m_ITcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99821, p-value = 0.988 ## alternative hypothesis: two.sided 結果の確認 いずれの違いも有意ではないよう。 estimate_contrasts(m_3m_ITcomp, contrast = &quot;study_period&quot;) 6.2.2.2.3.3 LK モデリング 説明変数を調査期間にしたものと、 focal_3m_sum_LK &lt;- focal_3m_sum_all %&gt;% filter(study_period != &quot;m21&quot; &amp; study_period != &quot;m20&quot;) ## 調査期間ごと m_3m_LKcomp &lt;- brm(data = focal_3m_sum_LK, sum_LK|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_LKcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_LKcomp) testZeroInflation(check_3m_LKcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99793, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 交尾期には非交尾期よりもLKが3m以内にいる割合が多いよう。 estimate_contrasts(m_3m_LKcomp, contrast = &quot;study_period&quot;) 6.2.2.2.3.4 KR モデリング 説明変数を調査期間にしたものと、 ## 調査期間ごと m_3m_KRcomp &lt;- brm(data = focal_3m_sum_all, sum_KR|trials(N) ~ study_period + (1|subject) + (1|date), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_KRcomp&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_KRcomp) testZeroInflation(check_3m_KRcomp) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.9996, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 2020年、2021年の交尾期は非交尾期よりKRが3m以内にいる割合が多いよう。 estimate_contrasts(m_3m_KRcomp, contrast = &quot;study_period&quot;) 6.2.2.2.3.5 交尾期内でのオス間の比較 データの加工 縦長のデータにする。 focal_3m_sum_all %&gt;% select(-rate_TY, -rate_IT, -rate_LK, -rate_KR) %&gt;% pivot_longer(cols = c(sum_TY, sum_IT, sum_LK, sum_KR), names_to = &quot;maleID&quot;, values_to = &quot;sum&quot;) -&gt; focal_3m_sum_long モデリング 調査年ごとに分けてモデリングを行う。 2018年 focal_3m_sum_long %&gt;% filter(study_period == &quot;m18&quot;) -&gt; focal_3m_sum_long18 m_3m_malecomp18 &lt;- brm(data = focal_3m_sum_long18, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp18&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp18) testZeroInflation(check_3m_malecomp18) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.99615, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 休息集団にいる割合はTY &gt; IT・LK &gt; KR estimate_contrasts(m_3m_malecomp18, contrast = &quot;maleID&quot;) 2019年 TYがいる日のTY、LK、KRの比較と、ITがいる日のIT、LK、KRの比較、どちらもいる日の全個体の比較を行う。 TYがいる日 focal_3m_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot;) -&gt; focal_3m_sum_long19_TY m_3m_malecomp19_TY &lt;- brm(data = focal_3m_sum_long19_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp19_TY&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp19_TY) testZeroInflation(check_3m_malecomp19_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0062, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 TY &gt; LK・KR estimate_contrasts(m_3m_malecomp19_TY, contrast = &quot;maleID&quot;) ITがいる日 focal_3m_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_TY&quot;) -&gt; focal_3m_sum_long19_IT m_3m_malecomp19_IT &lt;- brm(data = focal_3m_sum_long19_IT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp19_IT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp19_IT) testZeroInflation(check_3m_malecomp19_IT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0007, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 有意な差はなし。 estimate_contrasts(m_3m_malecomp19_IT, contrast = &quot;maleID&quot;) どちらもいる日 focal_3m_sum_long %&gt;% filter(study_period == &quot;m19&quot;) %&gt;% filter(IT == &quot;1&quot; &amp; TY == &quot;1&quot;) -&gt; focal_3m_sum_long19_TYIT m_3m_malecomp19_TYIT &lt;- brm(data = focal_3m_sum_long19_TYIT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp19_TYIT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp19_TYIT) testZeroInflation(check_3m_malecomp19_TYIT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98796, p-value = 0.974 ## alternative hypothesis: two.sided 結果の確認 TYと他の個体の差のみ有意。 estimate_contrasts(m_3m_malecomp19_TYIT, contrast = &quot;maleID&quot;) 2020年 TYがいる日のTY、KRの比較と、ITがいる日のIT、KRの比較を行う。どちらもいる日は6サンプルしかないため比較は行わない。 TYがいる日 focal_3m_sum_long %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot;) %&gt;% filter(maleID != &quot;sum_LK&quot;) -&gt; focal_3m_sum_long20_TY m_3m_malecomp20_TY &lt;- brm(data = focal_3m_sum_long20_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp20_TY&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp20_TY) testZeroInflation(check_3m_malecomp20_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0049, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 有意な差はなし。 estimate_contrasts(m_3m_malecomp20_TY, contrast = &quot;maleID&quot;) ITがいる日 focal_3m_sum_long %&gt;% filter(study_period == &quot;m20&quot;) %&gt;% filter(IT == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_TY&quot;)%&gt;% filter(maleID != &quot;sum_LK&quot;) -&gt; focal_3m_sum_long20_IT m_3m_malecomp20_IT &lt;- brm(data = focal_3m_sum_long20_IT, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp20_IT&quot;) モデルチェック 過分散やゼロ過剰などの問題はないよう。 plot(check_3m_malecomp20_IT) testZeroInflation(check_3m_malecomp20_IT) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98983, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 有意な差はなし。 estimate_contrasts(m_3m_malecomp20_IT, contrast = &quot;maleID&quot;) 2021年 TYがいる日のTY、KRの比較を行う。 focal_3m_sum_long %&gt;% filter(study_period == &quot;m21&quot;) %&gt;% filter(TY == &quot;1&quot;) %&gt;% filter(maleID != &quot;sum_IT&quot; &amp; maleID != &quot;sum_LK&quot;) -&gt; focal_3m_sum_long21_TY m_3m_malecomp21_TY &lt;- brm(data = focal_3m_sum_long21_TY, sum|trials(N) ~ maleID + (1|subject) + (1|date) + (1|no_focal), family = &quot;beta_binomial&quot;, control=list(adapt_delta = 0.9999, max_treedepth = 22), backend = &quot;cmdstanr&quot;, file = &quot;model/m_3m_malecomp21_TY&quot;) モデルチェック 少し当てはまりが悪いよう。 plot(check_3m_malecomp21_TY) testZeroInflation(check_3m_malecomp21_TY) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 1.0063, p-value = 1 ## alternative hypothesis: two.sided 結果の確認 TY &gt; KR。 estimate_contrasts(m_3m_malecomp21_TY, contrast = &quot;maleID&quot;) 6.2.2.3 休息集団内ににいたメス割合の比較 6.2.2.3.1 割合の算出 まず、非交尾期と交尾期のそれぞれについて休息集団内に各オスがいた割合を算出する。なお、少なくとも地上休息/毛づくろいが3ポイント以上続いた場合のみを抽出する。サル団子場面は外す。 すくなとも15ポイント以上あるデータのみを使用。 focal_raw_nm19_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(hud != &quot;1&quot;) %&gt;% mutate(prop_female = (1+RGfemale)/no_female) %&gt;% group_by(no_focal, subject, study_period, date, no_female) %&gt;% summarise(N = n(), sum = sum(RGfemale), mean = mean(prop_female)) %&gt;% ungroup() %&gt;% filter(N &gt;= 15) -&gt; focal_RGfemale_sum_nm 交尾期でも同様に算出。交尾期は非発情メスを追跡した日のみを使用する。 focal_raw_prox_fin %&gt;% filter(RG == &quot;1&quot;) %&gt;% filter(RGsuc3 == &quot;1&quot;) %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% mutate(prop_female = (RGfemale+1)/no_female) %&gt;% group_by(no_focal, subject, study_period, TY, IT, date, no_female) %&gt;% summarise(N = n(), sum = sum(RGfemale), mean = mean(prop_female)) %&gt;% ungroup() %&gt;% filter(N &gt;= 15) -&gt; focal_RGfemale_sum データを結合する。 bind_rows(focal_RGfemale_sum, focal_RGfemale_sum_nm) %&gt;% replace_na(list(TY = 1, IT = 1)) %&gt;% mutate(date = as.factor(date)) %&gt;% mutate(season = ifelse(str_detect(study_period,&quot;nm&quot;),&quot;nm&quot;,&quot;m&quot;)) %&gt;% mutate(bunbo = no_female*N) -&gt; focal_RGfemale_sum_all 6.2.2.3.2 分析 調査期間ごとの比較を行う。 m_RGfemale_comp &lt;- brm(data = focal_RGfemale_sum_all, sum|trials(bunbo) ~ study_period + (1|subject) + (1|date) , iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), family = &quot;beta_binomial&quot;, backend = &quot;cmdstanr&quot;, file = &quot;model/m_RGfemale_comp&quot;) 結果の確認 estimate_contrasts(m_RGfemale_comp, contrast = &quot;study_period&quot;) focal_RGfemale_sum_all %&gt;% filter(TY != &quot;2&quot;) %&gt;% mutate(TY2 = ifelse(season == &quot;m&quot; &amp; TY == &quot;1&quot;, &quot;mTY&quot;, ifelse(season == &quot;m&quot; &amp; TY == &quot;0&quot;, &quot;mnotTY&quot;, &quot;nm&quot;))) %&gt;% mutate(cat = str_c(study_period,&quot;_&quot;,TY2)) %&gt;% mutate(bunbo = no_female*N) -&gt; focalRGfemale_sum_TY m_RGfemale_comp_TY &lt;- brm(data = focalRGfemale_sum_TY, sum|trials(bunbo) ~ cat + (1|subject) + (1|date) , iter = 5000, warmup = 2500, seed = 13, prior = c(prior(student_t(4,0,10), class = &quot;b&quot;), prior(student_t(4,0,10), class = &quot;Intercept&quot;), prior(student_t(4,0,10), class = &quot;sd&quot;)), control=list(adapt_delta = 0.9999, max_treedepth = 20), family = &quot;beta_binomial&quot;, backend = &quot;cmdstanr&quot;, file = &quot;model/m_RGfemale_comp_TY&quot;) check_RGfemale_comp &lt;- dh_check_brms(m_RGfemale_comp_TY) estimate_contrasts(m_RGfemale_comp_TY, contrast = &quot;cat&quot;) "],["basic_data.html", "7 基礎情報の算出と図表の作成 7.1 群れ追跡時間、調査日数、発情メス数、群れ外オス数のデータ 7.2 発情メス数と群れ外オス数の関連 7.3 個体追跡データ", " 7 基礎情報の算出と図表の作成 本章では、群れ追跡時間や個体追跡時間などの基本的なデータをまとめる。 7.1 群れ追跡時間、調査日数、発情メス数、群れ外オス数のデータ 発情メス数と群れ外オス数については、300分以上追跡した日のデータのみを使用した。 base_all %&gt;% mutate(season = ifelse(month(date) &gt;= 9 &amp; month(date) &lt;= 12,&quot;m&quot;,&quot;nm&quot;)) %&gt;% mutate(study_period = str_c(season,str_sub(year(date),3,4))) %&gt;% left_join(male_all %&gt;% filter(ntm == &quot;1&quot;) %&gt;% group_by(date) %&gt;% summarise(no_ntm = sum(presence, na.rm = TRUE)) %&gt;% ungroup(), by = &quot;date&quot;) %&gt;% left_join(female_all %&gt;% group_by(date) %&gt;% summarise(no_est = sum(rs2, na.rm = TRUE)) %&gt;% ungroup(), by = &quot;date&quot;) %&gt;% mutate(date = as_date(date)) %&gt;% filter(date != &quot;2019-11-22&quot; &amp; date != &quot;2019-11-23&quot;) -&gt; base_all_b base_all_b %&gt;% filter(study_period != &quot;nm20&quot;) %&gt;% group_by(study_period) %&gt;% summarise(N = n(), follow = str_c(sprintf(&quot;%.2f&quot;,mean(duration)),&quot; ± &quot;,sprintf(&quot;%.2f&quot;, sd(duration)))) %&gt;% ungroup() -&gt; follow_summary base_all_b %&gt;% filter(duration &gt;= 300) %&gt;% filter(!str_detect(study_period, &quot;nm&quot;)) %&gt;% group_by(study_period) %&gt;% summarise(mean_est = str_c(sprintf(&quot;%.2f&quot;,mean(no_est, na.rm = TRUE)),&quot; ± &quot;,sprintf(&quot;%.2f&quot;, sd(no_est, na.rm = TRUE))), range_est = str_c(min(no_est),&quot;–&quot;,max(no_est)), mean_ntm = str_c(sprintf(&quot;%.2f&quot;,mean(no_ntm, na.rm = TRUE)),&quot; ± &quot;,sprintf(&quot;%.2f&quot;, sd(no_ntm, na.rm = TRUE))), range_ntm = str_c(min(no_ntm),&quot;–&quot;,max(no_ntm))) %&gt;% mutate(mean_ntm = ifelse(str_detect(mean_ntm,&quot;NA&quot;),NA,mean_ntm))-&gt; daily_summary left_join(follow_summary, daily_summary) %&gt;% mutate(season = ifelse(str_detect(study_period,&quot;nm&quot;),&quot;非交尾期&quot;,&quot;交尾期&quot;)) %&gt;% mutate(year = str_c(&quot;20&quot;,str_sub(study_period,-2,-1))) %&gt;% select(season, year, everything()) %&gt;% select(-study_period) %&gt;% replace_na(list(mean_est = &quot;-&quot;, range_est = &quot;-&quot;, mean_ntm = &quot;-&quot;, range_ntm = &quot;-&quot;)) %&gt;% rename(&quot;季節&quot; = 1,&quot;観察年&quot; = 2, &quot;観察日数&quot; = 3, &quot; 平均±SD&quot; = 4, &quot;平均±SD&quot; = 5, &quot;範囲&quot; = 6, &quot;平均±SD &quot; = 7, &quot;範囲 &quot; = 8) %&gt;% flextable() %&gt;% add_header_row(values = c(&quot;&quot;,&quot;群れ追跡時間&quot;,&quot;発情メス数&quot;,&quot;群れ外オス数&quot;), colwidth = c(3,1,2,2)) %&gt;% merge_v(j = 1) %&gt;% theme_zebra() %&gt;% align(j = 3:8, part = &quot;all&quot;, align = &quot;center&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 2:8, fontname = &quot;Times New Roman&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 1, fontname = &quot;Yu Mincho&quot;) %&gt;% flextable::font(part = &quot;header&quot;, j = 1:8, fontname = &quot;Yu Mincho&quot;) %&gt;% set_table_properties(layout = &quot;autofit&quot;, width = 1) %&gt;% width(j=c(4), width = 1.5) %&gt;% width(j = c(5,7), width = 1.3)-&gt; table_daily_summary table_daily_summary .cl-e8207004{table-layout:auto;width:100%;}.cl-e8151c5e{font-family:'Yu Mincho';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8151c72{font-family:'Yu Mincho';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8151c73{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8194d92{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e8194d9c{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e8196cbe{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cc8{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cc9{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cca{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cd2{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cdc{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cdd{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cde{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196ce6{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196ce7{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196ce8{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8196cf0{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}群れ追跡時間発情メス数群れ外オス数季節観察年観察日数 平均±SD平均±SD範囲平均±SD 範囲 交尾期201862518.55 ± 239.765.72 ± 3.610–11--201965528.48 ± 280.551.84 ± 1.650–56.20 ± 1.763–10202090591.53 ± 163.800.70 ± 0.960–34.35 ± 2.220–9202189569.62 ± 195.564.58 ± 4.210–147.90 ± 2.461–13非交尾期201947530.98 ± 265.83----202146612.70 ± 177.98----202244568.07 ± 216.75---- # save_as_image(table_daily_summary, &quot;table/table_daily_summary.png&quot;) 7.2 発情メス数と群れ外オス数の関連 300分以上追跡した日について、発情メス数と群れ外オス数の関連を調べる。 base_all_b %&gt;% filter(duration &gt;= 300) %&gt;% filter(!str_detect(study_period,&quot;nm&quot;)) %&gt;% filter(study_period != &quot;m18&quot;) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,-2,-1),&quot;年&quot;)) %&gt;% ggplot(aes(x = no_est, y = no_ntm))+ geom_count()+ scale_size(range = c(3,7))+ scale_size_continuous(breaks = seq(2,10,by =2))+ labs(x = &quot;発情メス数&quot;, y = &quot;群\\nれ\\n外\\nオ\\nス\\n数&quot;, size = &quot;観察日数&quot;)+ theme_bw(base_size = 16)+ facet_rep_wrap(~study_period, repeat.tick.labels = TRUE, scales = &quot;free&quot;, ncol = 2)+ scale_x_continuous(breaks = scales::pretty_breaks(4.5))+ scale_y_continuous(breaks = seq(0,15,by=2))+ theme(strip.background = element_blank(), strip.text = element_text(hjust = 0, family = &quot;Yu Mincho&quot;), aspect.ratio = 1, legend.position = c(0.7,0.2), axis.title.y = element_text(angle = 0, vjust = 0.5, family = &quot;Yu Mincho&quot;), axis.title.x = element_text(family = &quot;Yu Mincho&quot;), legend.title = element_text(family = &quot;Yu Mincho&quot;), axis.text = element_text(&quot;Times New Roman&quot;), legend.text = element_text(family = &quot;Times New Roman&quot;)) -&gt; p_est_ntm # ggsave(&quot;figure/p_est_ntm.png&quot;, p_est_ntm, width = 180, height = 180, units = &quot;mm&quot;, dpi = 600) knitr::include_graphics(&quot;figure/p_est_ntm.png&quot;) 図7.1: 発情メス数と群れ外オス数の関連 7.3 個体追跡データ 7.3.1 各個体の追跡時間概要 7.3.1.1 交尾期 att &lt;- read_csv(&quot;data/attributes.csv&quot;) focal_raw_fin %&gt;% group_by(no_focal, subject, study_period, rs2) %&gt;% summarise(dur = max(time)) %&gt;% ungroup() %&gt;% group_by(study_period, subject, rs2) %&gt;% summarise(N = n(), mean = mean(dur), sd = sd(dur, na.rm = TRUE)) %&gt;% replace_na(list(sd = 0)) %&gt;% ungroup() %&gt;% mutate(meansd = str_c(sprintf(&quot;%.2f&quot;,mean),&quot;±&quot;,sprintf(&quot;%.2f&quot;,sd))) %&gt;% left_join(att, by = c(&quot;study_period&quot;,&quot;subject&quot; = &quot;femaleID&quot;)) -&gt; focal_summary focal_summary %&gt;% ungroup() %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% select(-rs2, -mean, -sd) %&gt;% group_by(study_period) %&gt;% mutate(subject = fct_reorder(subject,rank)) %&gt;% ungroup() %&gt;% select(-rank, -age) %&gt;% left_join(focal_summary %&gt;% filter(rs2 == &quot;1&quot;) %&gt;% select(-rs2, -mean, -sd) %&gt;% group_by(study_period) %&gt;% mutate(subject = fct_reorder(subject,rank)) %&gt;% ungroup() %&gt;% select(-rank, -age), by = c(&quot;study_period&quot;, &quot;subject&quot;)) %&gt;% arrange(study_period, subject) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% rename(&quot;調査期間&quot; = 1,&quot;個体名&quot; = 2, &quot;N&quot; = 3, &quot;平均±SD(分)&quot; = 4, &quot;N &quot; = 5, &quot;平均±SD(分) &quot; = 6) %&gt;% flextable() %&gt;% add_header_row(values = c(&quot;&quot;,&quot;非発情&quot;,&quot;発情&quot;), colwidth = c(2,2,2)) %&gt;% merge_v(j = 1) %&gt;% theme_zebra() %&gt;% align(j = 3:6, part = &quot;all&quot;, align = &quot;center&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 2:6, fontname = &quot;Times New Roman&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 1, fontname = &quot;Yu Mincho&quot;) %&gt;% flextable::font(part = &quot;header&quot;, j = 1:6, fontname = &quot;Yu Mincho&quot;) %&gt;% set_table_properties(layout = &quot;autofit&quot;, width = 1) %&gt;% width(j=c(4,6), width = 1.5) -&gt; table_focal_summary table_focal_summary .cl-e8e0c64c{table-layout:auto;width:100%;}.cl-e8d800e8{font-family:'Yu Mincho';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8d800f2{font-family:'Yu Mincho';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8d800f3{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e8db6148{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e8db6152{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e8db716a{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7174{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7175{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db717e{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7188{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7189{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7192{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7193{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e8db7194{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}非発情発情調査期間個体名N平均±SD(分)N 平均±SD(分) 2018年Kil593.80±5.76292.50±3.54Kit490.00±0.00488.00±3.37Koh590.60±5.37396.33±7.02Kur592.20±5.50293.00±5.66Kun1106.00±0.00693.33±14.22Kol595.40±12.072104.00±21.21Ntr686.17±11.46289.50±0.71Ten599.40±10.31294.00±7.07Aka490.00±0.00482.00±21.21Ako4100.00±8.41380.33±11.24Tam489.50±0.58390.00±0.00Tot795.00±6.30Hen490.50±1.00386.33±5.51Hot491.50±3.00391.00±9.54Mik589.60±0.55290.50±0.71Mal584.80±12.19381.00±15.59Mei690.00±0.002104.00±21.212019年Kil499.25±10.69Kit686.00±7.27Koh490.00±0.00Kun483.00±16.06290.00±0.00Kol697.67±12.68Ntr690.50±1.22Ten689.50±14.31Aka3100.67±16.77Ako490.00±0.00194.00±0.00Tam390.00±0.00391.00±1.73Tot693.33±14.72190.00±0.00Hen382.33±13.28390.00±0.00Hot283.50±9.19497.50±15.00Mik485.00±12.08Mal592.00±2.12Mei695.00±12.25Mif490.75±1.502020年Kil15125.20±49.17Kol12142.08±30.81Ntr11141.55±36.238165.50±17.17Ten14147.00±35.53Aka3149.67±30.5010162.00±15.49Hot11147.73±38.7714141.93±54.87Mal10153.40±17.006130.50±48.552021年Kil18130.78±31.4113163.00±41.02Kol22139.32±39.944150.00±0.00Ntr16152.94±8.379113.11±55.47Ten15137.40±28.489136.00±39.51Hot17138.59±33.81Mal21149.14±4.492147.00±4.24 # save_as_image(table_focal_summary, &quot;table/table_focal_summary.png&quot;) 7.3.1.2 非交尾期 bind_rows(focal_list19nm, focal_list21nm, focal_list22nm) %&gt;% dplyr::select(study_period, subject, duration) %&gt;% group_by(study_period, subject) %&gt;% summarise(N = n(), mean = mean(duration), sd = sd(duration, na.rm = TRUE)) %&gt;% replace_na(list(sd = 0)) %&gt;% ungroup() %&gt;% mutate(meansd = str_c(sprintf(&quot;%.2f&quot;,mean),&quot;±&quot;,sprintf(&quot;%.2f&quot;,sd))) %&gt;% dplyr::select(-mean, -sd) %&gt;% left_join(att %&gt;% select(study_period, femaleID,rank), by = c(&quot;study_period&quot;,&quot;subject&quot; = &quot;femaleID&quot;)) %&gt;% group_by(study_period) %&gt;% mutate(subject = fct_reorder(subject,rank)) %&gt;% ungroup() %&gt;% arrange(study_period, subject) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,3,4),&quot;年&quot;)) %&gt;% rename(&quot;調査期間&quot; = 1,&quot;個体名&quot; = 2, &quot;N&quot; = 3, &quot;平均±SD(分)&quot; = 4) %&gt;% select(-rank) %&gt;% flextable() %&gt;% merge_v(j = 1) %&gt;% theme_zebra() %&gt;% align(j = 3:4, part = &quot;all&quot;, align = &quot;center&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 2:4, fontname = &quot;Times New Roman&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 1, fontname = &quot;Yu Mincho&quot;) %&gt;% flextable::font(part = &quot;header&quot;, j = 1:4, fontname = &quot;Yu Mincho&quot;) %&gt;% set_table_properties(layout = &quot;autofit&quot;, width = 1) %&gt;% width(j=c(3,4), width = 1.5)-&gt; table_focal_summary_nm table_focal_summary_nm .cl-e909ae5e{table-layout:auto;width:100%;}.cl-e9005be2{font-family:'Yu Mincho';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e9005bec{font-family:'Yu Mincho';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e9005bf6{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e9036bde{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e9036be8{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e9037a48{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9037a52{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9037a5c{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9037a5d{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9037a5e{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9037a66{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}調査期間個体名N平均±SD(分)2019年Kil790.00±0.00Kit790.00±0.00Koh790.14±0.38Kur792.43±4.16Kun798.00±13.71Kol790.00±0.00Ntr791.00±2.65Ten794.29±11.34Aka790.00±0.00Ako7106.29±14.10Tam799.43±16.20Tot791.43±3.78Hen793.00±7.09Hot797.43±12.90Mik792.14±2.91Mal790.00±0.00Mei790.00±0.002021年Kil3150.00±0.00Kit3150.00±0.00Koh3150.00±0.00Kun3150.00±0.00Kol2150.00±0.00Ntr3150.00±0.00Ten3150.00±0.00Aka3150.00±0.00Ako3151.67±2.89Tam2150.00±0.00Tot3150.00±0.00Hen4150.00±0.00Hot3150.00±0.00Mik3150.00±0.00Mal3150.00±0.00Mei3150.00±0.00Mif3150.00±0.002022年Kil6150.00±0.00Kit5150.00±0.00Koh6151.00±2.45Kun5150.00±0.00Kol6151.00±2.45Ntr6150.33±0.82Ten6150.00±0.00Aka6150.67±1.63Ako5150.00±0.00Tot6144.33±30.99Hen6139.17±26.54Hot6150.17±0.41Mik5149.60±0.89Mal5150.00±0.00Mei6152.50±6.12Mif5153.40±7.60 # save_as_image(table_focal_summary_nm, &quot;table/table_focal_summary_nm.png&quot;) 7.3.2 簡略版 7.3.2.1 交尾期 focal_raw_fin %&gt;% group_by(no_focal, subject, study_period, rs2) %&gt;% summarise(dur = max(time)) %&gt;% ungroup() %&gt;% group_by(study_period,rs2) %&gt;% summarise(N_subject = length(unique(subject)), N = n(), mean = mean(dur), sd = sd(dur)) %&gt;% ungroup() %&gt;% mutate(meansd = str_c(sprintf(&quot;%.2f&quot;,mean),&quot;±&quot;,sprintf(&quot;%.2f&quot;,sd))) %&gt;% select(-mean,-sd) -&gt; focal_summary_sim focal_summary_sim %&gt;% filter(rs2 == &quot;0&quot;) %&gt;% select(-rs2) %&gt;% bind_cols(focal_summary_sim %&gt;% filter(rs2 == &quot;1&quot;) %&gt;% select(-rs2) %&gt;% select(-study_period)) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,2,3),&quot;年&quot;)) %&gt;% rename(&quot;調査期間&quot; = 1,&quot;観察個体数&quot; = 2, &quot;N&quot; = 3,&quot;平均±SD(分)&quot; = 4, ,&quot;観察個体数 &quot; = 5, &quot;N &quot; = 6, &quot;平均±SD(分) &quot; = 7) %&gt;% flextable() %&gt;% add_header_row(values = c(&quot;&quot;,&quot;非発情&quot;,&quot;発情&quot;), colwidth = c(1,3,3)) %&gt;% merge_v(j = 1) %&gt;% theme_zebra() %&gt;% align(j = 2:7, part = &quot;all&quot;, align = &quot;center&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 2:7, fontname = &quot;Times New Roman&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 1, fontname = &quot;Yu Mincho&quot;) %&gt;% flextable::font(part = &quot;header&quot;, j = 1:7, fontname = &quot;Yu Mincho&quot;) %&gt;% set_table_properties(layout = &quot;autofit&quot;, width = 1) %&gt;% width(j=c(4,7), width = 1.3) -&gt; table_focal_summary_sim table_focal_summary_sim .cl-e9430bcc{table-layout:auto;width:100%;}.cl-e93be2fc{font-family:'Yu Mincho';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e93be306{font-family:'Yu Mincho';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e93be307{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e93eb360{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e93eb36a{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e93ec10c{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec10d{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec116{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec117{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec120{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec121{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec122{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec12a{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e93ec12b{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}非発情発情調査期間観察個体数N平均±SD(分)観察個体数 N 平均±SD(分) 2018年177991.94±7.65164690.22±11.872019年177690.92±10.5761492.64±7.982020年776142.18±36.47438150.37±40.842021年6109141.42±28.42639142.44±43.32 # save_as_image(table_focal_summary_sim, &quot;table/table_focal_summary_sim.png&quot;) 7.3.2.2 非交尾期 bind_rows(focal_list19nm, focal_list21nm, focal_list22nm) %&gt;% group_by(study_period) %&gt;% summarise(N_subject = length(unique(subject)), N = n(), mean = mean(duration), sd = sd(duration)) %&gt;% ungroup() %&gt;% mutate(meansd = str_c(sprintf(&quot;%.2f&quot;,mean),&quot;±&quot;,sprintf(&quot;%.2f&quot;,sd))) %&gt;% select(-mean,-sd) %&gt;% mutate(study_period = str_c(&quot;20&quot;,str_sub(study_period,3,4),&quot;年&quot;)) %&gt;% rename(&quot;調査期間&quot; = 1,&quot;観察個体数&quot; = 2, &quot;N&quot; = 3,&quot;平均±SD(分)&quot; = 4) %&gt;% flextable() %&gt;% theme_zebra() %&gt;% align(j = 2:4, part = &quot;all&quot;, align = &quot;center&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 2:4, fontname = &quot;Times New Roman&quot;) %&gt;% flextable::font(part = &quot;body&quot;, j = 1, fontname = &quot;Yu Mincho&quot;) %&gt;% flextable::font(part = &quot;header&quot;, j = 1:4, fontname = &quot;Yu Mincho&quot;) %&gt;% set_table_properties(layout = &quot;autofit&quot;, width = 1) %&gt;% width(j=c(4), width = 1.3)-&gt; table_focal_summary_nm_sim table_focal_summary_nm_sim .cl-e95d8736{table-layout:auto;width:100%;}.cl-e954d12c{font-family:'Yu Mincho';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e954d136{font-family:'Yu Mincho';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e954d140{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e9581896{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e95818a0{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e9582930{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e958293a{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9582944{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9582945{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e958294e{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e958294f{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9582950{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9582958{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e9582959{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}調査期間観察個体数N平均±SD(分)2019年1711993.27±8.532021年1750150.10±0.712022年1690149.44±10.50 # save_as_image(table_focal_summary_nm_sim, &quot;table/table_focal_summary_nm_sim.png&quot;) "],["RGsuc.html", "8 休息は何分連続で行われる? 8.1 データの加工 8.2 分析", " 8 休息は何分連続で行われる? ニホンザルは、移動の間に数十秒程度の短い休息をとることがよくある。こうした短時間の休息を統計的に除くことはできるだろうか？ ここでは、ゼロ過剰モデルを用いることで一時的な休息とそれ以外の休息を区別できるのかを検討する。 8.1 データの加工 個体追跡データから、地上での休息が何回連続で起こっているのかを計算する。 focal_raw %&gt;% mutate(RG = ifelse(activity %in% c(&quot;R&quot;,&quot;G&quot;) &amp; T_G == &quot;G&quot;,1,0)) %&gt;% group_by(no_focal, date, study_period, subject) %&gt;% summarise(N = rle(RG)$lengths, RG = rle(RG)$values) %&gt;% filter(RG == &quot;1&quot;) %&gt;% mutate(N_minus = N-1) %&gt;% ungroup()-&gt; N_suc 連続した回数ごとの度数を示したのが以下の図である(図8.1)。 N_suc %&gt;% group_by(N) %&gt;% summarise(num = n()) %&gt;% ggplot(aes(x = N, y = num))+ geom_col()+ scale_x_continuous(breaks = seq(0,121,1)) 図8.1: 地上での休息が何回連続で続いたか 8.2 分析 8.2.1 モデリング 以下では、一時的な休息がそうでない休息に混ざっていると仮定するゼロ過剰モデルと、そうではないモデルをデータに適用する。なお、ゼロ過剰モデルを適用するため、休息の連続回数から1を引く。 いずれのモデルにも負の二項分布を適用した。ゼロ過剰モデルについては、こちらを参照。 ## ゼロ過剰モデル m_rgsuc_zi &lt;- brm(bf(N_minus ~ study_period + (1|subject), zi ~ 1 + (1|subject)), family = zero_inflated_negbinomial(), iter = 5000, warmup = 2500, seed = 13, control=list(adapt_delta = 0.999, max_treedepth = 15), backend = &quot;cmdstanr&quot;, data = N_suc, file = &quot;model/m_rgsuc_zi.rds&quot;) m_rgsuc_nb &lt;- brm(N_minus ~ study_period + (1|subject), family = negbinomial, iter = 5000, warmup = 2500, seed = 13, control=list(adapt_delta = 0.999, max_treedepth = 15), backend = &quot;cmdstanr&quot;, data = N_suc, file = &quot;model/m_rgsuc_nb.rds&quot;) 8.2.1.1 モデルチェック 負の二項分布でもゼロ過剰にはなっていなかった。つまり、ゼロ過剰モデルを仮定しなくてもデータの0の多さを説明できているということである。 testZeroInflation(check_nb) ## ## DHARMa zero-inflation test via comparison to expected zeros with ## simulation under H0 = fitted model ## ## data: simulationOutput ## ratioObsSim = 0.98146, p-value = 0.528 ## alternative hypothesis: two.sided 8.2.1.2 結果の確認 ゼロ過剰モデル 推定されたゼロ過剰の切片は-4.97である。これは、0.01でしか「偽物の」ゼロが含まれていないことを示している。 model_parameters(m_rgsuc_zi) 負の二項分布モデル model_parameters(m_rgsuc_nb) 8.2.2 モデル比較 それでは、どちらのモデルの予測性がより優れているかをモデル比較で検討する。モデル比較にはWAICを用いている。 loo_rgsuc_zi &lt;- add_criterion(m_rgsuc_zi, criterion = &quot;waic&quot;) loo_rgsuc_nb &lt;- add_criterion(m_rgsuc_nb, criterion = &quot;waic&quot;) loo_comp &lt;- loo_compare(loo_rgsuc_zi, loo_rgsuc_nb, criterion = &quot;waic&quot;) モデル比較の観点からも、ゼロ過剰モデルよりも負の二項分布モデルの方が予測がうまくできることが分かった。 print(loo_comp, simplify = F) ## elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic ## loo_rgsuc_nb 0.0 0.0 -6253.1 90.3 14.7 1.4 12506.2 ## loo_rgsuc_zi -1.0 0.5 -6254.1 90.3 15.9 1.4 12508.3 ## se_waic ## loo_rgsuc_nb 180.5 ## loo_rgsuc_zi 180.5 8.2.3 モデルからの予測値と実データの比較。 set.seed(123) coef(m_rgsuc_zi) %&gt;% data.frame() %&gt;% select(1,5,9,13,17) %&gt;% rename(In = 1, ziIn = 2, m19 = 3, m20 = 4, m21 = 5) %&gt;% bind_cols(data.frame(m18 = rep(0,18))) %&gt;% rownames_to_column(var = &quot;subject&quot;) %&gt;% pivot_longer(m19:m18, values_to = &quot;coef&quot;, names_to = &quot;study_period&quot;) -&gt; coef_zi N_suc %&gt;% select(subject, study_period) %&gt;% left_join(coef_zi, by = c(&quot;subject&quot;, &quot;study_period&quot;)) %&gt;% mutate(prob = inv_logit_scaled(ziIn)) %&gt;% mutate(onezero = ifelse(rbernoulli(nrow(N_suc),prob),0,1)) %&gt;% mutate(mu = exp(In + coef)) %&gt;% mutate(N = onezero*rnbinom(nrow(N_suc), mu = exp(In + coef),size = posterior_summary(m_rgsuc_zi)[8,1])) %&gt;% ggplot(aes(x = N ))+ geom_histogram(binwidth = 1, fill = &quot;red3&quot;, alpha = 0.3)+ geom_col(data = N_suc %&gt;% group_by(N_minus) %&gt;% summarise(num = n()), aes(x = N_minus, y = num), alpha = 0.7) + theme_bw()+ scale_y_continuous(expand= c(0.01,0))+ theme(aspect.ratio = 0.8)+ labs(title = &quot;zero-inflated model&quot;, x = &quot;N-1&quot;) -&gt; p_zi set.seed(123) coef(m_rgsuc_nb) %&gt;% data.frame() %&gt;% select(1,5,9,13) %&gt;% rename(In = 1, m19 = 2, m20 = 3, m21 = 4) %&gt;% bind_cols(data.frame(m18 = rep(0,18))) %&gt;% rownames_to_column(var = &quot;subject&quot;) %&gt;% pivot_longer(m19:m18, values_to = &quot;coef&quot;, names_to = &quot;study_period&quot;)-&gt; coef_nb N_suc %&gt;% select(subject, study_period) %&gt;% left_join(coef_nb, by = c(&quot;subject&quot;, &quot;study_period&quot;)) %&gt;% mutate(N = rnbinom(nrow(N_suc), mu = exp(In + coef), size = posterior_summary(m_rgsuc_nb)[6,1])) %&gt;% ggplot(aes(x = N )) + geom_histogram(binwidth = 1, fill = &quot;red3&quot;, alpha = 0.3)+ geom_col(data = N_suc %&gt;% group_by(N_minus) %&gt;% summarise(num = n()), aes(x = N_minus, y = num), alpha = 0.7)+ theme_bw()+ scale_y_continuous(expand= c(0.01,0))+ theme(aspect.ratio = 0.8)+ labs(title = &quot;negative binomial model&quot;, x = &quot;N-1&quot;) -&gt; p_nb 各モデルから予測された値の分布と、実データの分布を比較したのが図8.2である。灰色バーが実データで、赤いバーがモデルから予測された値である。 グラフを見ると、ゼロ過剰モデルを用いなくてもモデルからの予測値が実データとうまくマッチしていることが分かる。つまり、このアプローチでは短時間の休息とそのほかの休息を区別することはできなかった。 p_rgsuc &lt;- p_zi + p_nb p_rgsuc 図8.2: 実データと各モデルの予測値の比較 # ggsave(&quot;figure/p_rgsuc.png&quot;, width = 220, height = 110, dpi = 600, units = &quot;mm&quot;) "],["sessioninfo.html", "実行環境", " 実行環境 sessionInfo() ## R version 4.2.2 (2022-10-31 ucrt) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## Running under: Windows 10 x64 (build 22621) ## ## Matrix products: default ## ## locale: ## [1] LC_COLLATE=Japanese_Japan.utf8 LC_CTYPE=Japanese_Japan.utf8 ## [3] LC_MONETARY=Japanese_Japan.utf8 LC_NUMERIC=C ## [5] LC_TIME=Japanese_Japan.utf8 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] rmdformats_1.0.4 fontregisterer_0.3 ## [3] systemfonts_1.0.4 extrafont_0.18 ## [5] ggsignif_0.6.4 ggplotify_0.1.0 ## [7] lemon_0.4.6 ggsci_2.9 ## [9] stargazer_5.2.3 kableExtra_1.3.4 ## [11] knitr_1.42 DT_0.27 ## [13] flextable_0.9.1 patchwork_1.1.2 ## [15] igraph_1.3.5 ggraph_2.1.0 ## [17] tidygraph_1.2.2 ANTs_0.0.1 ## [19] sna_2.7 network_1.18.0 ## [21] statnet.common_4.7.0 asnipe_1.1.16 ## [23] ggdist_3.3.0 ggeffects_1.1.4 ## [25] see_0.7.5.5 report_0.5.7.4 ## [27] parameters_0.20.3 performance_0.10.3 ## [29] modelbased_0.8.6.3 insight_0.19.1.4 ## [31] effectsize_0.8.3.6 datawizard_0.7.1.1 ## [33] correlation_0.8.4 bayestestR_0.13.1 ## [35] easystats_0.6.0.8 DHARMa.helpers_0.0.0.9000 ## [37] DHARMa_0.4.6 rstan_2.26.13 ## [39] StanHeaders_2.26.13 brms_2.18.0 ## [41] Rcpp_1.0.9 glmmTMB_1.1.5 ## [43] lme4_1.1-31 Matrix_1.5-1 ## [45] dbplyr_2.2.1 readxl_1.4.1 ## [47] lubridate_1.9.0 timechange_0.1.1 ## [49] forcats_1.0.0 stringr_1.5.0 ## [51] dplyr_1.1.2 purrr_1.0.0 ## [53] readr_2.1.3 tidyr_1.2.1 ## [55] tibble_3.2.1 ggplot2_3.4.2 ## [57] tidyverse_1.3.2 ## ## loaded via a namespace (and not attached): ## [1] estimability_1.4.1 coda_0.19-4 ragg_1.2.4 ## [4] bit64_4.0.5 dygraphs_1.1.1.6 data.table_1.14.6 ## [7] inline_0.3.19 doParallel_1.0.17 generics_0.1.3 ## [10] callr_3.7.3 bit_4.0.5 tzdb_0.3.0 ## [13] webshot_0.5.4 xml2_1.3.3 httpuv_1.6.7 ## [16] assertthat_0.2.1 viridis_0.6.2 gargle_1.2.1 ## [19] xfun_0.36 hms_1.1.3 jquerylib_0.1.4 ## [22] bayesplot_1.10.0 evaluate_0.20 promises_1.2.0.1 ## [25] fansi_1.0.3 DBI_1.1.3 htmlwidgets_1.6.1 ## [28] tensorA_0.36.2 googledrive_2.0.0 stats4_4.2.2 ## [31] ellipsis_0.3.2 crosstalk_1.2.0 backports_1.4.1 ## [34] fontLiberation_0.1.0 V8_4.2.2 bookdown_0.31 ## [37] markdown_1.7 RcppParallel_5.1.6 fontBitstreamVera_0.1.1 ## [40] vctrs_0.6.2 cmdstanr_0.5.3 abind_1.4-5 ## [43] cachem_1.0.6 withr_2.5.0 ggforce_0.4.1 ## [46] vroom_1.6.0 checkmate_2.1.0 emmeans_1.8.3 ## [49] xts_0.12.2 prettyunits_1.1.1 svglite_2.1.1 ## [52] crayon_1.5.2 crul_1.3 labeling_0.4.2 ## [55] pkgconfig_2.0.3 tweenr_2.0.2 nlme_3.1-160 ## [58] rlang_1.1.1 lifecycle_1.0.3 miniUI_0.1.1.1 ## [61] colourpicker_1.2.0 fontquiver_0.2.1 httpcode_0.3.0 ## [64] extrafontdb_1.0 modelr_0.1.10 Kendall_2.2.1 ## [67] cellranger_1.1.0 distributional_0.3.2 tcltk_4.2.2 ## [70] polyclip_1.10-4 matrixStats_0.63.0 loo_2.5.1 ## [73] boot_1.3-28 zoo_1.8-11 reprex_2.0.2 ## [76] base64enc_0.1-3 processx_3.8.0 googlesheets4_1.0.1 ## [79] png_0.1-8 viridisLite_0.4.1 gap.datasets_0.0.5 ## [82] visNetwork_2.1.2 shinystan_2.6.0 gridGraphics_0.5-1 ## [85] scales_1.2.1 magrittr_2.0.3 plyr_1.8.8 ## [88] threejs_0.3.3 compiler_4.2.2 rstantools_2.2.0 ## [91] cli_3.6.0 ps_1.7.2 TMB_1.9.1 ## [94] Brobdingnag_1.2-9 mgcv_1.8-41 MASS_7.3-58.1 ## [97] tidyselect_1.2.0 stringi_1.7.8 textshaping_0.3.6 ## [100] highr_0.10 yaml_2.3.7 askpass_1.1 ## [103] ggrepel_0.9.2 bridgesampling_1.1-2 grid_4.2.2 ## [106] sass_0.4.5 tools_4.2.2 parallel_4.2.2 ## [109] rstudioapi_0.14 uuid_1.1-0 foreach_1.5.2 ## [112] gridExtra_2.3 posterior_1.3.1 farver_2.1.1 ## [115] digest_0.6.31 shiny_1.7.4 qgam_1.3.4 ## [118] gfonts_0.2.0 broom_1.0.2 later_1.3.0 ## [121] httr_1.4.4 gdtools_0.3.3 colorspace_2.0-3 ## [124] rvest_1.0.3 fs_1.5.2 splines_4.2.2 ## [127] yulab.utils_0.0.6 graphlayouts_0.8.4 shinythemes_1.2.0 ## [130] xtable_1.8-4 jsonlite_1.8.4 nloptr_2.0.3 ## [133] gap_1.4-2 R6_2.5.1 pillar_1.9.0 ## [136] htmltools_0.5.4 mime_0.12 glue_1.6.2 ## [139] fastmap_1.1.0 minqa_1.2.5 codetools_0.2-18 ## [142] pkgbuild_1.4.0 mvtnorm_1.1-3 utf8_1.2.2 ## [145] lattice_0.20-45 bslib_0.4.2 numDeriv_2016.8-1.1 ## [148] curl_4.3.3 gtools_3.9.4 officer_0.6.2 ## [151] Rttf2pt1_1.3.8 zip_2.2.2 shinyjs_2.1.0 ## [154] openssl_2.0.5 rmarkdown_2.20 munsell_0.5.0 ## [157] iterators_1.0.14 haven_2.5.1 reshape2_1.4.4 ## [160] gtable_0.3.3 References Chang, W. (2018). R graphics cookbook: Practical recipes for visualizing data. “O’Reilly Media, Inc.” Wickham, H., &amp; Grolemund, G. (2016). R for data science: Import, tidy, transform, visualize, and model data. “O’Reilly Media, Inc.” 松村優哉., 湯谷啓明., 紀ノ定保礼., &amp; 前田和. (2021). RユーザのためのRstudio[実践]入門 tidyverseによるモダンな分析フローの世界 改訂2版. 技術評論社. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
